var R=Object.defineProperty,T=Object.defineProperties;var I=Object.getOwnPropertyDescriptors;var x=Object.getOwnPropertySymbols;var L=Object.prototype.hasOwnProperty,M=Object.prototype.propertyIsEnumerable;var k=(n,s,a)=>s in n?R(n,s,{enumerable:!0,configurable:!0,writable:!0,value:a}):n[s]=a,b=(n,s)=>{for(var a in s||(s={}))L.call(s,a)&&k(n,a,s[a]);if(x)for(var a of x(s))M.call(s,a)&&k(n,a,s[a]);return n},N=(n,s)=>T(n,I(s));import{r as o,R as e,ah as $,X as q,J as z,O as y,a2 as K,ar as J,a7 as W,as as X,I as G,at as H,au as Q,f as U,T as S}from"./vendor.25eb60fb.js";import{C as V}from"./index.6c8aecb8.js";import{b as F,u as Y}from"./index.22863799.js";import{a as Z}from"./event.3f2c0b25.js";var j=o.exports.memo(({list:n,updatePackage:s,removePackage:a,onProgress:u})=>{const{socket:l}=F();o.exports.useEffect(()=>(l.on("progress_changed",t=>{if(t&&t.progressChanged&&t.progressChanged.args){const{progress:r,status:i,args:d}=t.progressChanged;if(r===void 0||r===-1)return;const p={progress:r,status:i,name:d[0]};u(p)}}),l.on("progress_removed",t=>{u({progress:-1,status:"",name:""})}),l.on("uninstall_dep_done",t=>{a(t)}),l.on("update_dep_done",t=>{s(t)}),()=>{l.off("progress_changed"),l.off("progress_removed"),l.off("uninstall_dep_done"),l.off("update_dep_done")}),[]);const E=t=>{const r=N(b({},t),{progress:0});u(r)},f=t=>{E({status:"dependency-install",name:t}),l.emit("install_dep",{id:t,type:"devDependencies"})},g=t=>{E({status:"dependency-uninstall",name:t}),l.emit("uninstall_dep",{id:t})},v=t=>{E({status:"dependency-update",name:t}),l.emit("update_dep",{id:t})};return e.createElement("div",{className:"wrapper-deps-list"},e.createElement("div",{className:"deps-list"},e.createElement("ul",null,n&&n.map(t=>e.createElement("li",{key:t.id},e.createElement("div",{className:"deps-logo"},e.createElement("img",{src:t.avatars,alt:""})),e.createElement("div",{className:"deps-content"},e.createElement("div",{className:"name"},t.id),e.createElement("div",{className:"description"},e.createElement("span",null,"\u5F53\u524D ",e.createElement("small",null,t.current)),e.createElement("span",null,"\u6700\u65B0 ",e.createElement("small",null,t.latest)),e.createElement("span",null,e.createElement("span",null,t.installed&&e.createElement(e.Fragment,null,e.createElement($,null)," \u5DF2\u5B89\u88C5"),!t.installed&&e.createElement(e.Fragment,null,e.createElement(q,null)," \u672A\u5B89\u88C5")),e.createElement("a",{href:t.website,target:"_blank",className:"link"},"\u67E5\u770B\u8BE6\u60C5")))),e.createElement("div",{className:"deps-button"},e.createElement(z,null,(()=>t.installed?t.current!=t.latest?e.createElement(y,{placement:"top",title:`\u66F4\u65B0 ${t.id}`},e.createElement(J,{onClick:()=>v(t.id)})):null:e.createElement(y,{placement:"top",title:`\u5B89\u88C5 ${t.id}`},e.createElement(K,{onClick:()=>f(t.id)})))(),e.createElement(y,{placement:"top",title:`\u79FB\u9664 ${t.id}`},e.createElement(W,{onClick:()=>g(t.id)})))))))))});function ee(n,s=300){let a=null;return(...u)=>{clearTimeout(a),a=setTimeout(()=>{n.apply(null,u)},s)}}const te=n=>n.map((s,a)=>{const{link:u,name:l,description:E,version:f}=s;return{value:l,label:e.createElement("div",{style:{display:"flex",justifyContent:"space-between"}},e.createElement("span",null,l,e.createElement("small",null,"\xA0\xA0",e.createElement("a",{href:u,target:"_blank",rel:"noopener noreferrer"},e.createElement(H,null)))),e.createElement("span",null,f))}});var ne=n=>{const{installPackage:s}=n,{request:a,data:u}=Y("/api/npm/search",{lazy:!0}),[l,E]=o.exports.useState([]),[f,g]=o.exports.useState([]),v=async r=>{if(!r||r.length<2)return;const i=await a({name:r});if(Array.isArray(i)){const d=[];i.forEach(p=>{d.push({name:p.name,version:p.version,description:p.description,link:p.links&&p.links.homepage})}),g(d),E(te(d))}},t=r=>{const i=f.find(d=>d.name===r);s(r,i==null?void 0:i.version)};return e.createElement("div",{className:""},e.createElement(X,{dropdownMatchSelectWidth:252,style:{width:300},options:l,onSelect:t,onSearch:ee(v)},e.createElement(G.Search,{size:"middle",allowClear:!0,placeholder:"\u5B89\u88C5\u4F9D\u8D56",enterButton:!0})))};const{TabPane:B}=S,m=[];var oe=()=>{const{socket:n}=F(),[s,a]=o.exports.useState(500),[u,l]=o.exports.useState("2"),[E,f]=o.exports.useState(!1),[g,v]=o.exports.useState({progress:-1,status:"",name:""}),[t,r]=o.exports.useState([]);Z(()=>{r([...m])},s),o.exports.useEffect(()=>(f(!0),n.emit("get_project_deps"),n.on("get_project_deps",c=>{m.find(h=>h.id===c.data.id)||m.push(c.data)}),n.on("get_project_deps_done",()=>{a(null),f(!1),r([...m])}),()=>{n.off("get_project_deps"),n.off("get_project_deps_done"),a(null),m.length=0}),[]);const i=({id:c,version:h,versionRange:_,type:D})=>{const C=m.find(P=>P.id===c);C&&(C.current=_||h,r([...m]))},d=({id:c,type:h})=>{const _=m.findIndex(D=>D.id===c);_>-1&&(m.splice(_,1),r([...m]))},p=c=>{v(c)},A=(c,h)=>{n.emit("install_dep",{id:c,type:u==="2"?"devDependencies":""}),p({progress:0,status:"",name:c})},O=o.exports.useMemo(()=>t.filter(c=>c.type!=="devDependencies"),[t]),w=o.exports.useMemo(()=>t.filter(c=>c.type==="devDependencies"),[t]);return e.createElement(V,{isMain:!0,title:"\u9879\u76EE\u4F9D\u8D56",className:"deps-container"},g.progress!==-1&&e.createElement("div",{className:"progress"},e.createElement("div",null,e.createElement(Q,{type:"circle",percent:Math.ceil(g.progress*63)}),e.createElement("p",{className:"red"},g.name,": ",g.status))),e.createElement("div",{className:"deps-header mbm10"},e.createElement(ne,{installPackage:A}),e.createElement("div",{className:"info"},E&&e.createElement("span",null,e.createElement(U,null))," ","\u4F9D\u8D56 ",t&&e.createElement("span",null,t.length," \u4E2A"))),e.createElement("div",{className:"rel"},e.createElement(S,{className:"tabs-oumi",activeKey:u,type:"card",onChange:c=>l(c)},e.createElement(B,{tab:"\u8FD0\u884C\u4F9D\u8D56",key:"1",forceRender:!1},e.createElement(j,{list:O,updatePackage:i,removePackage:d,onProgress:p})),e.createElement(B,{tab:"\u5F00\u53D1\u4F9D\u8D56",key:"2",forceRender:!1},e.createElement(j,{list:w,updatePackage:i,removePackage:d,onProgress:p})))))};export{oe as default};
