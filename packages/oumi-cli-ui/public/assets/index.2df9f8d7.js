var e=Object.defineProperty,t=Object.defineProperties,a=Object.getOwnPropertyDescriptors,s=Object.getOwnPropertySymbols,r=Object.prototype.hasOwnProperty,n=Object.prototype.propertyIsEnumerable,l=(t,a,s)=>a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[a]=s,c=(e,t)=>{for(var a in t||(t={}))r.call(t,a)&&l(e,a,t[a]);if(s)for(var a of s(t))n.call(t,a)&&l(e,a,t[a]);return e},i=(e,s)=>t(e,a(s));import{R as o,X as m,Y as d,I as p,Z as u,r as f,z as E,C as g,_ as y,$ as h,a0 as b,T as k,a1 as v,J as N,a2 as x,m as w,e as S,a3 as j,a4 as C,L as I}from"./vendor.b9d39691.js";import{u as P,i as O}from"./index.e4df6a1a.js";import{c as A,a as q}from"./index.03ffb951.js";import{C as T}from"./index.cd6d2183.js";import{C as z}from"./index.5f79f0e0.js";const D=["string","number","array","object","integer","boolean","int32","int64","ref","file"];function R(e,t){const a={};return function e(a,s){Array.isArray(s)?s.forEach((e=>{console.log("数组的暂没有处理~")})):s&&"object"==typeof s&&Object.keys(s).forEach((r=>{const n=c({},s[r]);if(n.isArray){delete n.isArray;const t={};e(t,n),a[r]=[t]}else if((l=n)&&void 0!==l.type&&D.includes(l.type))a[r]=function(e,t){const{type:a,items:s,explame:r}=e;if(r)return r;const n=s&&s.type?s.type:a;if("array"===a){if("integer"===n||"number"===n)return L(e,[1],t);if("string"===n)return L(e,["1"],t)}if("integer"===a||"number"===a)return L(e,1,t);if("string"===a)return L(e,"string",t);if("boolean"===a)return L(e,!0,t);return L(e,a,t)}(n,t);else{if(0===Number(r))return;a[r]={},e(a[r],n)}var l}))}(a,e),a}const L=(e,t,a)=>{const{resultValueType:s="type"}=a||{},{explame:r,description:n}=e;return"type"===s?t:r||n||t};var F=e=>{const{onFinish:t}=e;return o.createElement(m,{name:"customized_form_controls",layout:"inline",onFinish:t},o.createElement(m.Item,{name:"name",label:"搜索",tooltip:{title:"首字母是“v”或包含中文表示搜索tag，否则就是搜索path",icon:o.createElement(d,null)}},o.createElement(p,{placeholder:"可搜索关键字、tag、路径",style:{width:230},allowClear:!0})),o.createElement(m.Item,null,o.createElement(u,{type:"primary",htmlType:"submit"},"搜索")))};const{TabPane:V}=k;var _=e=>{const{swaggerList:t,expandData:a={},expandCacheId:s,loadingId:r,onClickSwaggerHead:n,setSelectId:l,selectId:m}=e,[d,p]=f.exports.useState(!1),[u,v]=f.exports.useState(null),[N,x]=f.exports.useState("1"),w=e=>{p(e)},S=(e,t)=>{w(!0),x("1"),v(null),setTimeout((()=>{v(i(c({},e),{key:t}))}),200)};return o.createElement("div",{className:"swagger-list"},t&&t.map((e=>o.createElement("div",{className:"swagger-list-item",key:e.id},o.createElement("div",{className:"heading",onClick:()=>n(e)},o.createElement("div",{className:"options"},r===e.id?o.createElement(E,null):s.includes(e.id)?o.createElement(g,null):o.createElement(y,null),s.includes(e.id)&&o.createElement("span",{className:"all",onClick:t=>((e,t)=>{const s=Object.keys(a[t.id]||{});m.includes(s[0])?l(m.filter((e=>!s.includes(e)))):l([...m,...s]),e.stopPropagation(),e.preventDefault()})(t,e)},"全选")),o.createElement("h3",null,e.name)),s.includes(e.id)&&o.createElement("div",{className:"content"},o.createElement("ul",{className:"content-list"},a&&a[e.id]&&Object.keys(a[e.id]).map((t=>{const s=a[e.id][t];return o.createElement("li",{className:`${s.methods||"get"}`,key:t},o.createElement("span",{className:"checkbox"},o.createElement(h,{value:t,onChange:()=>(e=>{m.includes(e)?l(m.filter((t=>t!==e))):l([...m,e])})(t),checked:m.includes(t)})),o.createElement("span",{className:"methods"},(s.methods||"get").toLocaleUpperCase()),o.createElement("span",{className:"path",onClick:()=>S(s,t)},t),o.createElement("span",{className:"desc",title:s.description,onClick:()=>S(s,t)},s.description),o.createElement("span",{className:"bg"},o.createElement(y,null)))}))))))),o.createElement(b,{title:u&&(u.description||u.key)||"",placement:"right",closable:!1,onClose:()=>w(!1),visible:d,width:800},o.createElement("p",{style:{position:"relative",top:-10}},"路径: ",u&&u.key),o.createElement(k,{className:"tabs-oumi",activeKey:N,type:"card",onTabClick:e=>x(e),style:{marginBottom:32}},o.createElement(V,{tab:"默认",key:"1",forceRender:!1},o.createElement("h3",{className:"mbm5"},"请求头（Request）："),o.createElement(z,{code:u&&R(u.request,{resultValueType:"type"})}),o.createElement("h3",{className:"mbm5"},"响应（Response）："),o.createElement(z,{code:u&&R(u.response,{resultValueType:"desc"})})),o.createElement(V,{tab:"详细",key:"2",forceRender:!1},o.createElement("h3",{className:"mbm5"},"请求头（Request）："),o.createElement(z,{code:u&&u.request}),o.createElement("h3",{className:"mbm5"},"响应（Response）："),o.createElement(z,{code:u&&u.response})))))},$=e=>{const{selectNode:t,onSuccess:a}=e,{dirPath:s}=t||{},[r]=m.useForm(),[n,l]=o.useState(!1),{data:i,request:d,loading:f}=P("/api/project/createDir",{lazy:!0}),E=e=>{l(e)};return o.createElement(v,{title:()=>o.createElement("div",null,o.createElement(m,{form:r,className:"my-popconfirm-form"},o.createElement(m.Item,{name:"dirName",label:"目录名称",rules:[{required:!0,message:"请输入目录名称"},{pattern:/^[a-zA-Z0-9_-]+$/,message:"请输入正确的目录名称"}]},o.createElement(p,null)))),visible:n,onConfirm:()=>{r.validateFields().then((e=>{d(c({currentPath:s},e)).then((e=>{l(!1),"function"==typeof a&&a()}))}))},placement:"top",okButtonProps:{loading:f},onCancel:()=>E(!1),icon:!1},o.createElement(u,{size:"middle",disabled:!t,onClick:()=>E(!0)},"新建文件夹"))};const{DirectoryTree:B}=x;function H(e,t,a){return e.map((e=>e.key===t?i(c({},e),{children:a}):e.children?i(c({},e),{children:H(e.children,t,a)}):e))}var K=e=>{const{selectId:t,setSelectId:a,configId:s}=e,[r,n]=f.exports.useState([]),[l,c]=f.exports.useState(null),{data:i,loading:m,request:d}=P("/api/swagger/build",{lazy:!0}),p=e=>O.post("/api/project/dirs",e),E=()=>{p().then((e=>{n(e)}))};function g({key:e,children:t,dirPath:a}){return new Promise((s=>{t?s():p({currentPath:a}).then((t=>{Array.isArray(t)&&n((a=>H(a,e,t))),s()}))}))}f.exports.useEffect((()=>{E()}),[]);return o.createElement("div",{className:"dirs"},o.createElement("div",{className:"dirs-box"},o.createElement("div",{className:"dirs-head"},"当前项目目录："),o.createElement(B,{loadData:g,treeData:r,onSelect:(e,t)=>{const{selected:a,node:s}=t,{isLeaf:r}=s;c(a&&!r?s:null)}})),o.createElement("div",{className:"dirs-btn"},o.createElement(N,null,o.createElement(u,{type:"primary",size:"middle",disabled:!l,onClick:()=>{if(t.length<=0&&w.warn("请选择需要导出的api"),l&&t.length>0){const{dirPath:e}=l;d({outputPath:e,searchContent:t,configId:s}).then((e=>{w.success("生成文件成功~"),a([])}))}},loading:m},"生成接口到目录"),o.createElement($,{selectNode:l,onSuccess:()=>{l&&l.key?g({key:l.key,dirPath:l.key}):E()}}))))};const{TabPane:U}=k,Z=()=>o.createElement(T,{title:"Swagger"},o.createElement("div",{className:"swagger-error"},"您当前还没有配置Swagger，去 ",o.createElement(I,{to:"/config"},"配置")," 。"));var J=f.exports.memo((()=>{const[e,t]=f.exports.useState(""),{data:a,error:s,loading:r}=P("/api/config/swagger/get"),{data:n,loading:l,request:m,source:d}=P("/api/swagger/info",{lazy:!0}),{request:p}=P("/api/swagger/search",{lazy:!0}),[u,E]=f.exports.useState([]),[g,y]=f.exports.useState({}),[h,b]=f.exports.useState(""),[v,N]=f.exports.useState([]),[x,I]=f.exports.useState([]);f.exports.useEffect((()=>()=>{d.cancel()}),[]),f.exports.useEffect((()=>{a&&a.length>0&&t(a[0].id)}),[a]),f.exports.useEffect((()=>{n&&Array.isArray(n.tags)&&E((e=>{const t=[],{paths:a}=e;return Object.keys(a).forEach((e=>{const s=a[e],r=s.get||s.post||s.delete||s.put;if(r){const{tags:e}=r;Array.isArray(e)&&e.forEach((e=>{t.some((t=>t.name===e))||t.push({name:e,description:s.summary,id:A(10)})}))}else console.warn(r)})),t.sort(q("name"))})(n))}),[n]),f.exports.useEffect((()=>{e&&(I([]),m({id:e}))}),[e]);if(r)return o.createElement(T,{title:"Swagger"},o.createElement(S,null));if(s||!Array.isArray(a)||0===a.length)return o.createElement(Z,null);const O=e=>{I(e?x.filter((t=>t!==e)):[])},z=o.createElement("div",{className:"popover-selected"},o.createElement("a",{onClick:()=>O()},"清空所有"),x&&x.map((e=>o.createElement("p",{key:e},e," ",o.createElement("span",{onClick:()=>O(e),title:"移除"},o.createElement(j,null))))));return o.createElement(T,{isMain:!0,title:"Swagger",className:"ui-swagger-container"},o.createElement(k,{className:"tabs-oumi",type:"card",defaultActiveKey:e,onTabClick:e=>{t(e)}},a&&a.map((e=>o.createElement(U,{tab:e.name,key:e.id})))),o.createElement("div",{className:"tabs-content"},l&&o.createElement("div",{className:"fetch-loading"},o.createElement(S,null)),o.createElement("div",{className:"selected flex align-items"},o.createElement(F,{onFinish:t=>{const{name:a}=t;if(a){const t=A(8);E([{name:a,description:"",id:t}]),N([t]),b(t);const s=/[\u4e00-\u9fa5]+/g,r=a.toLocaleUpperCase().startsWith("V")||s.test(a)?{searchTag:a}:{searchPath:a};p(c({configId:e},r)).then((e=>{if(b(""),"object"==typeof e&&Object.keys(e||{}).length>0){const a={};Object.keys(e).forEach((t=>{const s=e[t];a[t]={description:s.description,methods:s.methods,request:s.request,response:s.response}})),y({[t]:a})}else w.warning("没有数据")}))}else m({id:e})}}),o.createElement(C,{content:z,title:"已选中",placement:"bottom"},o.createElement("div",{className:"plp2"},"已选中",o.createElement("span",{className:"span"},x.length),"个"))),o.createElement("div",{className:"body-flex"},o.createElement(_,{selectId:x,setSelectId:I,swaggerList:u,loadingId:h,expandCacheId:v,expandData:g,onClickSwaggerHead:t=>{v.includes(t.id)?N(v.filter((e=>e!==t.id))):g[t.id]?N([...v,t.id]):(b(t.id),p({configId:e,searchTag:t.name}).then((e=>{if(b(""),"object"==typeof e&&Object.keys(e||{}).length>0){const a={};Object.keys(e).forEach((t=>{const s=e[t];a[t]={description:s.description,methods:s.methods,request:s.request,response:s.response}})),N([...v,t.id]),y(i(c({},g),{[t.id]:a}))}else w.warning("没有数据")})).catch((()=>{b("")})))}}),o.createElement(K,{selectId:x,setSelectId:I,configId:e}))))}));export{J as default};
