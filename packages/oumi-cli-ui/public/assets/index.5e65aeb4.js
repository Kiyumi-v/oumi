var O=Object.defineProperty,q=Object.defineProperties;var j=Object.getOwnPropertyDescriptors;var g=Object.getOwnPropertySymbols;var w=Object.prototype.hasOwnProperty,L=Object.prototype.propertyIsEnumerable;var v=(n,t,s)=>t in n?O(n,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):n[t]=s,k=(n,t)=>{for(var s in t||(t={}))w.call(t,s)&&v(n,s,t[s]);if(g)for(var s of g(t))L.call(t,s)&&v(n,s,t[s]);return n},y=(n,t)=>q(n,j(t));import{r as p,R as e,f as M,T as D,W as S,a5 as z,Y as K,I as R,a6 as _,e as A,ak as C,al as $,m as h,ag as J,n as V}from"./vendor.25eb60fb.js";import{u as B,i as Y}from"./index.22863799.js";import{C as G}from"./index.6c8aecb8.js";const{TabPane:H}=D,N="OUMI_BLOCKS";function x(){const n=sessionStorage.getItem(N);return n?JSON.parse(n):null}function I(n){const t=k({},n),s=x();return s&&Object.assign(t,s),sessionStorage.setItem(N,JSON.stringify(t))}var U=n=>{const{item:t,addToProject:s}=n,[r,i]=p.exports.useState({}),{data:l,loading:c,error:b,request:f,source:F,setData:m}=B("/api/block/getListFormGit",{lazy:!0}),d=()=>{if(t&&t.href){const u=x();if(u){const a=u[t.href];if(a){m(a);return}}f({url:t.href,useBuiltJSON:!0})}};return p.exports.useEffect(()=>(d(),()=>{F.cancel()}),[]),p.exports.useEffect(()=>{if(!l||!Array.isArray(l))return;const u={};l.forEach(a=>{const{tags:o}=a;o.forEach(E=>{u[E]?u[E].push(a):u[E]=[a]})}),t.href&&I({[t.href]:l}),i(u)},[l]),c?e.createElement("div",{className:"loading-blocks"},e.createElement(M,null)):b?e.createElement("div",{className:"error-blocks"},"\u8BF7\u6C42\u5931\u8D25\uFF0C",e.createElement("a",null,"https://raw.githubusercontent.com"),"\u57DF\u540D\u6709\u6CE2\u52A8\uFF0C",e.createElement("a",{onClick:d},"\u7A0D\u540E\u91CD\u8BD5"),"\u3002"):e.createElement("div",{className:"blocks-container"},e.createElement(D,{type:"card"},r&&Object.keys(r).map(u=>{const a=r[u];return e.createElement(H,{forceRender:!1,tab:u,key:u},e.createElement("div",{className:"blocks-list"},a&&a.map(o=>e.createElement("div",{className:"blocks-list__item",key:o.path},e.createElement("div",{className:"handler"},e.createElement("span",{onClick:()=>s(o)},"\u6DFB\u52A0\u5230\u9879\u76EE")),e.createElement("div",{className:"img"},e.createElement("img",{src:o.img,alt:""})),e.createElement("p",null,o.name)))))})))},W=n=>{const{selectNode:t,onSuccess:s}=n,{dirPath:r}=t||{},[i]=S.useForm(),[l,c]=e.useState(!1),{data:b,request:f,loading:F}=B("/api/project/createDir",{lazy:!0}),m=a=>{c(a)},d=()=>{i.validateFields().then(a=>{f(k({currentPath:r},a)).then(o=>{c(!1),typeof s=="function"&&s()})})},u=()=>e.createElement("div",null,e.createElement(S,{form:i,className:"my-popconfirm-form"},e.createElement(S.Item,{name:"dirName",label:"\u76EE\u5F55\u540D\u79F0",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u76EE\u5F55\u540D\u79F0"},{pattern:/^[a-zA-Z0-9_-]+$/,message:"\u8BF7\u8F93\u5165\u6B63\u786E\u7684\u76EE\u5F55\u540D\u79F0"}]},e.createElement(R,null))));return e.createElement(z,{title:u,visible:l,onConfirm:d,placement:"left",okButtonProps:{loading:F},onCancel:()=>m(!1),icon:!1},e.createElement(K,{size:"small",type:"primary",disabled:!t,onClick:()=>m(!0)},"\u65B0\u5EFA\u6587\u4EF6\u5939"))};const{DirectoryTree:Z}=_;function P(n,t,s){return n.map(r=>r.key===t?y(k({},r),{children:s}):r.children?y(k({},r),{children:P(r.children,t,s)}):r)}var Q=n=>{const{onSelect:t}=n,[s,r]=p.exports.useState([]),[i,l]=p.exports.useState(null),c=m=>Y.post("/api/project/dirs",m),b=()=>{c().then(m=>{r(m)})};p.exports.useEffect(()=>{b()},[]);function f({key:m,children:d,dirPath:u}){return new Promise(a=>{if(d){a();return}c({currentPath:u}).then(o=>{Array.isArray(o)&&r(E=>P(E,m,o)),a()})})}const F=(m,d)=>{const{selected:u,node:a}=d,{isLeaf:o}=a;l(u&&!o?a:null),t&&typeof t=="function"&&t(d)};return e.createElement("div",{className:"dirs",style:{maxHeight:450,overflow:"hidden",overflowY:"auto"}},e.createElement("div",{className:"dirs-box"},e.createElement(W,{selectNode:i,onSuccess:()=>{i&&i.key?f({key:i.key,dirPath:i.key}):b()}}),e.createElement(Z,{loadData:f,treeData:s,onSelect:F})))};const X=n=>{const t=A(),{modalData:s,setModalVisible:r}=n,i=s&&s.name?`\u6DFB\u52A0 - ${s==null?void 0:s.name} `:"\u6DFB\u52A0\u5230\u9879\u76EE",[l,c]=p.exports.useState(null),{data:b,loading:f,request:F}=B("/api/block/downloadFile",{lazy:!0}),m=()=>{!l||!s||F({destPath:l==null?void 0:l.dirPath,url:s.url}).then(a=>{a?h.success("\u4E0B\u8F7D\u6587\u4EF6\u5B8C\u6210"):h.error("\u4E0B\u8F7D\u6587\u4EF6\u5F02\u5E38"),r(null)}).catch(a=>{h.destroy(),a.code===999?C.confirm({title:"\u9650\u901F\u63D0\u793A!",icon:e.createElement(J,null),content:a.msg,onOk:()=>{t.push("/config?key=3")}}):h.error(a.msg||"\u8BF7\u6C42\u8D85\u65F6\uFF0C\u8BF7\u91CD\u8BD5~")})},d=()=>{r(null)},u=a=>{const{selected:o,node:E}=a,{isLeaf:T}=E;c(o&&!T?E:null)};return e.createElement(e.Fragment,null,e.createElement(C,{title:i,visible:!!s,style:{top:20},onOk:m,onCancel:d,okButtonProps:{disabled:!l,loading:f},okText:"\u786E\u8BA4\u6DFB\u52A0",cancelText:"\u53D6\u6D88"},e.createElement($,{message:"\u6E29\u99A8\u63D0\u793A\uFF1A\u8BE5\u529F\u80FD\u4F1A\u4E0B\u8F7D\u8FDC\u7A0B\u6587\u4EF6\uFF0C\u8BF7\u8010\u5FC3\u7B49\u5F85\uFF01\u{1F600}\u{1F600}\u{1F600}",type:"warning"}),e.createElement("br",null),e.createElement(Q,{onSelect:u})))};var ee=X;const{TabPane:te}=D;var ue=n=>{const[t,s]=p.exports.useState(null);A();const{data:r=[],request:i}=B("/api/block/getList"),l=c=>{s(c)};return e.createElement(G,{isMain:!0,title:"\u8D44\u4EA7",className:"dashboard-main"},e.createElement("div",{className:"dashboard-body"},e.createElement("div",{className:"ui-dashboard-content"},e.createElement("div",{className:"ui-content-container ui-main-container"},e.createElement(D,{className:"tabs-oumi",type:"line",defaultActiveKey:"1",tabPosition:"left"},r&&r.map(c=>e.createElement(te,{forceRender:!1,tab:e.createElement("span",null," ",e.createElement(V,null)," ",c.name," "),key:c.id,closable:!1},e.createElement(U,{item:c,addToProject:l})))))),e.createElement(ee,{modalData:t,setModalVisible:s})))};export{ue as default};
