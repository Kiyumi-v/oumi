var e=Object.defineProperty,t=Object.defineProperties,a=Object.getOwnPropertyDescriptors,l=Object.getOwnPropertySymbols,n=Object.prototype.hasOwnProperty,r=Object.prototype.propertyIsEnumerable,s=(t,a,l)=>a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:l}):t[a]=l,c=(e,t)=>{for(var a in t||(t={}))n.call(t,a)&&s(e,a,t[a]);if(l)for(var a of l(t))r.call(t,a)&&s(e,a,t[a]);return e},m=(e,l)=>t(e,a(l)),o=(e,t)=>{var a={};for(var s in e)n.call(e,s)&&t.indexOf(s)<0&&(a[s]=e[s]);if(null!=e&&l)for(var s of l(e))t.indexOf(s)<0&&r.call(e,s)&&(a[s]=e[s]);return a},i=(e,t,a)=>(s(e,"symbol"!=typeof t?t+"":t,a),a);import{r as d,R as u,I as E,ae as p,av as y,a6 as v,D as h,aw as b,ax as g,z as f,ay as k,B as N,M as x,a5 as C,aq as S,J as D,Y as q,W as O,V as P,az as w,aA as I,ak as T,aB as F,T as A,an as z,aC as R,aD as _,e as j,C as L,O as V,aE as J,$ as B,aF as G,m as K,d as U,U as $}from"./vendor.b6308d1a.js";import{u as H}from"./index.933877c2.js";import{l as M,c as W,u as Q}from"./index.03ffb951.js";import{C as Y}from"./index.cadc6c48.js";const{DirectoryTree:X}=v,Z=({addChildGroup:e})=>u.createElement(x,null,u.createElement(x.Item,null,u.createElement("a",{target:"_blank",rel:"noopener noreferrer",href:"",onClick:e=>{e.stopPropagation(),e.preventDefault()}},"1st menu item")),u.createElement(x.Item,null,u.createElement("span",{onClick:t=>((e,t)=>{e.stopPropagation(),e.preventDefault(),t()})(t,e)},"添加子分类"))),ee=d.exports.memo((e=>{const{node:t,addChildGroup:a,removeItem:l,removeLoading:n}=e,{group:r,key:s}=t;return u.createElement("div",{className:"tree-title"},u.createElement("div",{className:"title-name truncate"},t.title),u.createElement("div",{className:"title-handler"},r?u.createElement(h,{overlay:u.createElement(Z,{addChildGroup:a}),placement:"bottomCenter",arrow:!0},u.createElement(b,null)):u.createElement(u.Fragment,null,u.createElement("span",{className:"icons title-copy",title:"复制"},u.createElement(g,null)),u.createElement("span",{className:"icons title-delete",title:"删除",onClick:e=>{e.preventDefault(),e.stopPropagation(),l(s)}},n?u.createElement(f,null):u.createElement(k,null)))))}));var te=({addPane:e,list:t,removeItem:a,removeLoading:l,expandedKeys:n,onExpand:r})=>{const[s,c]=d.exports.useState([]),m=e=>{const t={title:"new parent1",key:Math.random(),group:1};c((a=>ae(a,e.key,[...e.children,t])))};return d.exports.useEffect((()=>{c((e=>{if(!Array.isArray(e))return[];const t=[...e];return function e(t){Array.isArray(t)&&t.forEach((t=>{t.isTest?t.icon=()=>u.createElement(N,null):t.method&&(t.icon=()=>u.createElement("span",{className:`method ${t.method}-color`},t.method.toLocaleUpperCase())),t.children&&e(t.children)}))}(t),t})(t))}),[t]),u.createElement("div",{className:"debugger-slider"},u.createElement("div",{className:"search"},u.createElement(E,{prefix:u.createElement(p,null),allowClear:!0,placeholder:"搜索"}),u.createElement("span",{className:"add",onClick:()=>e({title:"新建接口",isNew:!0})},u.createElement(y,null))),u.createElement("div",{className:"api-list"},u.createElement(X,{defaultExpandAll:!0,onSelect:(t,a)=>{const{node:l}=a;e({title:l.title,method:l.method,url:l.url,key:l.key,env:l.env,pkey:l.pkey,isTest:l.isTest})},treeData:s,allowDrop:({dropNode:e})=>!!e.group||!!(e.children&&e.children.length>0),onExpand:r,onDrop:e=>{const t=e.node.key,a=e.dragNode.key,l=e.node.pos.split("-"),n=e.dropPosition-Number(l[l.length-1]);if(!e.dropToGap&&!e.node.group)return;const r=[...s];let m;if(M(r,a,((e,t,a)=>{a.splice(t,1),m=e})),e.dropToGap)if((e.node.props.children||[]).length>0&&e.node.props.expanded&&1===n)M(r,t,(e=>{e.children=e.children||[],e.children.unshift(m)}));else{let e,a;M(r,t,((t,l,n)=>{e=n,a=l})),-1===n?e.splice(a,0,m):e&&e.splice(a+1,0,m)}else M(r,t,(e=>{e.children=e.children||[],e.children.unshift(m)}));c(r)},onDragEnter:e=>{},draggable:e=>!e.isLeaf,titleRender:e=>u.createElement(ee,{node:e,addChildGroup:()=>m(e),removeItem:a,removeLoading:l})})))};function ae(e,t,a){return e.map((e=>e.key===t?m(c({},e),{children:a}):e.children?m(c({},e),{children:ae(e.children,t,a)}):e))}const le=E.TextArea,ne=u.createContext(null),re=e=>{var t=e,{index:a}=t,l=o(t,["index"]);const[n]=O.useForm(),r=`${l["data-row-key"]}_form`||"form";return u.createElement(O,{form:n,name:r,component:!1},u.createElement(ne.Provider,{value:n},u.createElement("tr",c({},l))))},se=e=>{var t=e,{title:a,editable:l,children:n,dataIndex:r,record:s,handleSave:m}=t,i=o(t,["title","editable","children","dataIndex","record","handleSave"]);const[p,y]=d.exports.useState(!0),v=d.exports.useRef(null),h=d.exports.useContext(ne);d.exports.useEffect((()=>{p&&v.current}),[p]);const b=()=>{h.setFieldsValue({[r]:s[r]})},g=async()=>{try{const e=await h.validateFields(),t=c(c({},s),e);h.setFieldsValue(t),m(t)}catch(e){console.log("Save failed:",e)}};let f=n;return l&&(f=p?u.createElement(O.Item,{style:{margin:0},name:r,initialValue:s[r]},u.createElement(E,{ref:v,onPressEnter:g,onBlur:g})):u.createElement("div",{className:"editable-cell-value-wrap",style:{paddingRight:24},onClick:b},n)),u.createElement("td",c({},i),f)};class ce extends u.PureComponent{constructor(e){super(e),i(this,"columns"),i(this,"handleDelete",(e=>{const{onEditChange:t}=this.props,a=[...this.state.dataSource];this.setState({dataSource:a.filter((t=>t.key!==e))},(()=>{"function"==typeof t&&t(this.state.dataSource)}))})),i(this,"handleAdd",(()=>{const{dataSource:e}=this.state,t={key:W(5),name:"",value:"",remark:""};this.setState({dataSource:[...e,t]})})),i(this,"handleSave",(e=>{const{onEditChange:t}=this.props,a=[...this.state.dataSource],l=a.findIndex((t=>e.key===t.key)),n=a[l];a.splice(l,1,c(c({},n),e)),this.setState({dataSource:a}),"function"==typeof t&&t(a)}));const{size:t}=e;this.columns=[{title:"参数名",dataIndex:"name",width:"small"===t?"20%":"30%",editable:!0},{title:"参数值",dataIndex:"value",editable:!0},{title:"说明",dataIndex:"remark",editable:!0},{title:"处理",dataIndex:"operation",width:"small"===t?150:200,render:(e,t)=>this.state.dataSource.length>=1?u.createElement(C,{title:"确定删除?",onConfirm:()=>this.handleDelete(t.key)},u.createElement("a",null,"删除")):null}],this.state={toggle:!1,dataSource:e.tableData||[{key:"0",name:"",value:"",remark:""}]}}componentWillReceiveProps(e){e.tableData&&e.tableData!==this.state.dataSource&&setTimeout((()=>{this.setState({dataSource:e.tableData||[]})}),0)}render(){const{tableTitle:e}=this.props,{dataSource:t,toggle:a}=this.state,l={body:{row:re,cell:se}},n=this.columns.map((e=>e.editable?m(c({},e),{onCell:t=>({record:t,editable:e.editable,dataIndex:e.dataIndex,title:e.title,handleSave:this.handleSave})}):e));return u.createElement("div",{className:""},u.createElement("div",{className:"table-title mbm10"},e),u.createElement("div",{className:"flex rel"},u.createElement("div",{className:"rel table-pad flex-1"},!a&&u.createElement(S,{size:"small",components:l,rowClassName:()=>"editable-row",bordered:!0,dataSource:t,columns:n,pagination:!1}),a&&u.createElement("div",{className:"table-textarea"},u.createElement("div",{className:"t-header flex-sp"},u.createElement("p",null,"格式：参数名,必填,示例值,说明"),u.createElement("div",{className:"t-handler"},u.createElement(D,null,u.createElement(q,{size:"small",type:"primary"},"确定"),u.createElement(q,{size:"small",onClick:()=>this.setState({toggle:!1})},"取消")))),u.createElement(le,null),u.createElement("div",{className:"t-header flex-sp"},u.createElement("span",{className:"gray-color"},"字段之间以英文逗号(,)分隔，多条记录以换行分隔")))),u.createElement("div",{className:"table-row-btn"},u.createElement(q,{onClick:this.handleAdd,size:"small",style:{marginBottom:16}},"新增一行")),u.createElement("div",{className:"table-textarea-toggle",onClick:()=>this.setState({toggle:!this.state.toggle})},"批量修改")))}}var me=()=>u.createElement("div",{className:"request-content-front"},"接口前置");const oe=(e,t,a)=>{if(Array.isArray(e))for(let l=0;l<e.length;l++){if(e[l].key===t)return void a(e[l],l,e);e[l].children&&oe(e[l].children,t,a)}},ie=e=>{const t=[];return Array.isArray(e)&&e.forEach((e=>{e.title=e.title||(e=>{if(!e)return"";const t=e.startsWith("http");let a=t?new URL(e).pathname:e;return!t||"/"!==a&&a||(a=new URL(e).hostname),a})(e.url),e.pkey?oe(t,e.pkey,((t,a,l)=>{Array.isArray(t.children)?t.children.push(e):t.children=[e]})):t.push(e)})),t},de=[{name:"Response JSON",value:"1"}],ue=[{name:"必需存在",value:"required"},{name:"等于",value:"eq"},{name:"不等于",value:"neq"},{name:"小于",value:"lt"},{name:"小于或等于",value:"lte"},{name:"大于",value:"gt"},{name:"大于或等于",value:"gte"},{name:"包含",value:"include"},{name:"不包含",value:"ninclude"},{name:"为空",value:"empty"}],Ee=d.exports.createContext({responseData:null,requestData:{query:[],bodyFormData:[],bodyJSON:[],header:[],cookie:[]},setRequestData:e=>{},requestPostData:[],setRequestPostData:e=>{}}),pe=()=>d.exports.useContext(Ee),{Option:ye}=F,ve=d.exports.memo((e=>{const{visible:t,setVisible:a,callback:l,editData:n,title:r}=e,[s]=O.useForm();d.exports.useEffect((()=>{n?s.setFieldsValue(c({},n)):s.resetFields()}),[s,n]);const m=()=>{a(!1)};return u.createElement(T,{title:"添加断言",visible:t,onCancel:m,onOk:()=>{s.submit(),s.validateFields().then((e=>{"function"==typeof l&&l(c({},e)),m(),s.resetFields()}))},okText:"确定",cancelText:"取消"},u.createElement(O,{name:"form_config",form:s,labelCol:{span:5},initialValues:{type:"assert",assertObject:"1",assertEnumKey:"eq"}},u.createElement(O.Item,{name:"key",hidden:!0},u.createElement(E,null)),u.createElement(O.Item,{name:"type",hidden:!0},u.createElement(E,null)),u.createElement(O.Item,{name:"name",label:"断言名称"},u.createElement(E,null)),u.createElement(O.Item,{name:"assertObject",label:"断言对象"},u.createElement(F,{disabled:!0},de.map((e=>u.createElement(ye,{key:e.value,value:e.value},e.name))))),u.createElement(O.Item,{name:"expression",label:"提取表达式",rules:[{required:!0,message:"表达式必填"}]},u.createElement(E,{placeholder:"JSON path表达式，如$.data.list[0].name"})),u.createElement("div",{className:"flex assert-flex"},u.createElement(O.Item,{name:"assertEnumKey",label:"断言"},u.createElement(F,null,ue.map((e=>u.createElement(ye,{key:e.value,value:e.value},e.name))))),u.createElement(O.Item,{name:"assertValue",label:""},u.createElement(E,null)))))}));var he=d.exports.memo((e=>{const{requestPostData:t,setRequestPostData:a}=pe(),[l,n]=d.exports.useState(!1),[r,s]=d.exports.useState(null),[o,i]=d.exports.useState([]);d.exports.useEffect((()=>{i(t)}),[t]);const E=e=>{const{name:t,type:a,assertEnumKey:l,expression:n,assertValue:r}=e,s=ue.find((e=>e.value===l)),c=s?s.name:"",m="assert"===a?"断言":"";return u.createElement("span",null,u.createElement("span",{className:"type prp10"},m),t&&u.createElement("span",null,t),!t&&u.createElement("span",null,n," ",c," ",r))};return u.createElement("div",{className:"request-content-front"},u.createElement(D,{className:"mbm10"},u.createElement(q,{type:"primary",onClick:()=>{s(null),n(!0)}},"添加断言")),u.createElement(P,{itemLayout:"horizontal",dataSource:o,className:"assert-list",renderItem:e=>u.createElement(P.Item,null,u.createElement(P.Item.Meta,{title:u.createElement("div",{className:"flex-sp"},u.createElement("div",null,u.createElement("span",{className:"icon"},u.createElement(w,null))," ",u.createElement("span",null,E(e))),u.createElement("div",{className:"heandler"},u.createElement(D,null,u.createElement(I,{className:"cur",onClick:()=>(e=>{n(!0),s(e)})(e)}),u.createElement(C,{title:"确定要删除吗?",onConfirm:()=>(e=>{a(o.filter((t=>t.key!==e.key)))})(e),okText:"Yes",cancelText:"No"},u.createElement(k,{className:"cur",onClick:e=>{e.stopPropagation()}})))))}))}),u.createElement(ve,{visible:l,setVisible:n,editData:r,callback:e=>{let t=[];if(e.key){const a=o.findIndex((t=>t.key===e.key));a>-1&&(o.splice(a,1,e),t=[...o])}else{const a=m(c({},e),{key:W()});t=[...o,a]}a(t)}}))}));const{TabPane:be}=A;var ge=e=>{const{setRequestData:t,requestData:a}=pe(),{isTestExample:l}=e,[n,r]=d.exports.useState(!1),[s,c]=d.exports.useState("6"),[m,o]=d.exports.useState(1);d.exports.useEffect((()=>{a&&!1===n&&(a.bodyFormData&&Object.keys(a.bodyFormData).length>0?(c("2"),o(2),r(!0)):a.bodyJSON&&Object.keys(a.bodyJSON).length>0?(c("2"),o(3),r(!0)):a.query&&a.query.length>0?(c("1"),r(!0)):a.header&&a.header.length>0&&(c("3"),r(!0)))}),[a,n]);const i=(e,a)=>{t({[e]:a})};return u.createElement(A,{activeKey:s,onChange:e=>c(e)},u.createElement(be,{tab:"Params",key:"1"},u.createElement(ce,{tableData:a.query,tableTitle:"Query参数",onEditChange:e=>i("query",e)})),u.createElement(be,{tab:"Body",key:"2"},u.createElement(z.Group,{onChange:e=>{const{value:t}=e.target;o(t)},name:"bodyRadioGroup",value:m},u.createElement(z,{value:1},"none"),u.createElement(z,{value:2},"form-data"),u.createElement(z,{value:3},"json")),1===m&&u.createElement("div",{className:"body-none"},"该请求无 Body "),2===m&&u.createElement("div",null,u.createElement(ce,{tableData:a.bodyFormData,onEditChange:e=>i("bodyFormData",e)})),3===m&&u.createElement("div",null,u.createElement(ce,{tableData:a.bodyJSON,onEditChange:e=>i("bodyJSON",e)}))),u.createElement(be,{tab:"Header",key:"3"},u.createElement(ce,{tableData:a.header,onEditChange:e=>i("header",e)})),u.createElement(be,{tab:"Cookie",key:"4"},u.createElement(ce,{tableData:a.cookie,onEditChange:e=>i("cookie",e)})),l&&u.createElement(be,{tab:"接口前置",key:"5"},u.createElement(me,null)),l&&u.createElement(be,{tab:"接口后置",key:"6"},u.createElement(he,null)))};const{TabPane:fe}=A;var ke=e=>{const{responseData:t}=pe(),{header:a={},body:l="",isJSON:n,status:r,statusText:s,timer:c,requestHeader:m,fetchUrl:o,assertResult:i}=t||{},[E,p]=d.exports.useState("pretty");return u.createElement("div",{className:"rel"},u.createElement(A,{defaultActiveKey:"1"},u.createElement(fe,{tab:"Body",key:"1"},Array.isArray(i)&&u.createElement("div",{className:"assert-result"},u.createElement("p",null,"断言结果："),i.map(((e,t)=>u.createElement("div",{className:"assert-result__item",key:t},u.createElement("div",{className:"icon "+(e.success?"green":"red")},e.success&&u.createElement(R,null),!e.success&&u.createElement(_,null)),u.createElement("div",{className:"name"},e.name))))),u.createElement(z.Group,{onChange:e=>{const{value:t}=e.target;p(t)},value:E},u.createElement(z.Button,{value:"pretty"},"Pretty"),u.createElement(z.Button,{value:"preview"},"Preview")),"pretty"===E&&u.createElement("div",{className:"response-body"},u.createElement(Y,{code:l})),"preview"===E&&u.createElement("div",{className:"response-body"},u.createElement(Y,{code:"object"==typeof l?JSON.stringify(l):l}))),u.createElement(fe,{tab:"Response Headers",key:"3"},u.createElement("div",{className:"list-line"},u.createElement("div",{className:"list-line_item"},u.createElement("span",{className:"name"},"名称"),u.createElement("span",{className:"value"},"值")),a&&Object.keys(a).map((e=>{const t=a[e];return u.createElement("div",{className:"list-line_item",key:e},u.createElement("span",{className:"name"},e),u.createElement("span",{className:"value"},Array.isArray(t)?t[0]:t))})))),u.createElement(fe,{tab:"Request Headers",key:"4"},u.createElement("div",{className:"list-line"},u.createElement("div",{className:"list-line_item"},u.createElement("span",{className:"name"},"名称"),u.createElement("span",{className:"value"},"值")),m&&Object.keys(m).map((e=>{const t=m[e]||"";return u.createElement("div",{className:"list-line_item",key:e},u.createElement("span",{className:"name"},e),u.createElement("span",{className:"value",title:t},t))})))),u.createElement(fe,{tab:"Other",key:"5"},u.createElement("div",{className:"list-line"},u.createElement("div",{className:"list-line_item"},u.createElement("span",{className:"name"},"URL"),u.createElement("span",{className:"value"},o))))),u.createElement("div",{className:`response-status status-${r}`},r&&u.createElement("span",null,"状态码:"," ",u.createElement("u",null,r," ",s)),r&&u.createElement("span",null,"耗时: ",u.createElement("u",null,c," ms"))))},Ne=e=>{const{onAddCase:t}=e,[a]=O.useForm();return u.createElement(C,{title:()=>u.createElement("div",null,u.createElement(O,{form:a,className:"my-popconfirm-form"},u.createElement(O.Item,{name:"name",label:"用例名称",rules:[{required:!0,message:"请输入用例名称"}]},u.createElement(E,null)))),onConfirm:()=>{a.validateFields().then((e=>{t(e)}))},placement:"bottom",onCancel:e=>((e,t)=>{t&&(t.preventDefault(),t.stopPropagation())})(0,e),icon:!1},u.createElement(q,{type:"primary",danger:!0,icon:u.createElement(N,null)},"另存为用例"))};const xe=({onClick:e})=>u.createElement(x,null,u.createElement(x.Item,{key:"get",onClick:()=>e("get")},u.createElement("span",null,"GET")),u.createElement(x.Item,{key:"post",onClick:()=>e("post")},u.createElement("span",null,"POST"))),Ce=()=>u.createElement("div",null,u.createElement("h2",null,"项目概览的内容。"),u.createElement("p",null,"接口调速器！"));var Se=d.exports.memo((e=>{const{pane:t,env:a,onSaveSuccess:l,addChildTree:n}=e,{isTest:r,isNew:s}=t,[o,i]=d.exports.useState(""),[p,y]=d.exports.useState("get"),[v,b]=d.exports.useState([]),[g,f]=d.exports.useState({query:[],bodyFormData:[],bodyJSON:[],header:[],cookie:[]}),{request:k,loading:x}=H("/api/debugger/taskDetail",{lazy:!0}),{request:C}=H("/api/debugger/creatTestExp",{lazy:!0}),{request:S,loading:O,data:P}=H("/api/debugger/runTask",{lazy:!0}),{request:w,loading:I}=H("/api/debugger/saveTask",{lazy:!0}),T={requestData:g,responseData:P,setRequestData:f,requestPostData:v,setRequestPostData:b},F=async()=>{const e=await w({key:t.key,method:p,url:o,env:a,request:g,requestPost:v,isTest:r});"function"==typeof l&&l({pane:c(m(c({},t),{prevKey:t.key}),e)}),K.success("保存成功")},A=e=>{const{value:t}=e.target;i(t)};return d.exports.useEffect((()=>{t&&t.key&&"1"!==t.key&&k({key:t.key,pkey:t.pkey}).then((e=>{e&&(e.url&&i(e.url),e.method&&y(e.method),e.request&&f(e.request),e.requestPost&&b(e.requestPost))}))}),[t]),"1"===t.key?u.createElement(Ce,null):x?u.createElement("div",{className:"rel",style:{height:300}},u.createElement("div",{className:"fetch-loading"},u.createElement(j,null))):u.createElement(Ee.Provider,{value:T},u.createElement("div",{className:"content-body"},u.createElement("div",{className:"d-header flex-center"},u.createElement("div",{className:"radius flex-center"},!r&&u.createElement("div",{className:`method ${p}-color`},u.createElement(h,{overlay:u.createElement(xe,{onClick:y}),trigger:["click"]},u.createElement("div",null,p.toLocaleUpperCase()," ",u.createElement(L,null)))),r&&u.createElement("div",{className:`method ${p}-color`},u.createElement("span",{style:{marginRight:10}},p.toLocaleUpperCase()),u.createElement(V,{placement:"bottom",title:"测试用例的URL需要父级保存才能生效哦~"},u.createElement(J,null))),u.createElement("div",{className:"input"},!r&&u.createElement(E,{placeholder:'接口路径 "/"或"http"起始 ',onChange:A,defaultValue:t.url}),r&&u.createElement(E,{placeholder:'接口路径 "/"或"http"起始 ',onChange:A,value:o,disabled:!0}))),u.createElement("div",{className:"handler rel"},!s&&u.createElement(D,null,u.createElement(q,{type:"primary",icon:u.createElement(B,null),onClick:()=>{S({method:p,url:o,env:a,request:g,requestPost:v})},loading:O},"运行"),!r&&u.createElement(Ne,{onAddCase:e=>{C({title:e.name,pkey:t.key}).then((e=>{const a=c({},e);a.icon=()=>u.createElement(N,null),n(t.key,[a]),K.success("添加用例成功")}))}}),u.createElement(q,{type:"default",icon:u.createElement(G,null),onClick:F,loading:I},"保存")),s&&u.createElement(D,null,u.createElement(q,{type:"primary",icon:u.createElement(G,null),onClick:F,loading:I},"保存")))),u.createElement("div",{className:"content-scroll"},u.createElement("h2",{className:"title"},"请求参数："),u.createElement("div",{className:"request"},u.createElement(ge,{isTestExample:r})),u.createElement("h2",{className:"title"},"响应结果："),u.createElement("div",{className:"response"},u.createElement(ke,null)))))}));const{TabPane:De}=A,qe=()=>u.createElement("div",{className:"tips"},"温馨提示：每次保存仅限当前选项卡的内容！"),Oe={e1:"开发环境",e2:"测试环境",e3:"生产环境"},Pe={e1:"dev",e2:"test",e3:"prod"},we=d.exports.memo((({form:e,ckey:t,onChange:a,envList:l})=>{const[n,r]=d.exports.useState({dev:[],test:[],prod:[]});return d.exports.useEffect((()=>{const a=Pe[t],s={name:Oe[t],env:a,url:""};if(Array.isArray(l)){const t=l.find((e=>e.envName===a));if(t&&(r(m(c({},n),{[a]:t.data})),t.form))return void e.setFieldsValue(c({},t.form))}e.setFieldsValue(s)}),[e,t]),u.createElement(u.Fragment,null,u.createElement(O,{name:`${e}_${t}`,form:e,labelCol:{span:3},initialValues:{url:"http: 127.0.0.1"}},u.createElement(O.Item,{name:"name",label:"环境名称",rules:[{required:!0,message:"请输入环境名称"}]},u.createElement(E,null)),u.createElement(O.Item,{name:"url",label:"前置URL"},u.createElement(E,null)),u.createElement(O.Item,{name:"env",hidden:!0},u.createElement(E,null))),u.createElement("div",{className:"title"},"环境变量"),u.createElement(ce,{tableData:n[Pe[t]],size:"small",onEditChange:e=>(e=>{const l=Pe[t],s=m(c({},n),{[l]:e});r(s),a(e,"envList")})(e)}),u.createElement(qe,null))})),Ie=d.exports.memo((({ckey:e,onChange:t,form:a,globalData:l})=>{const[n,r]=d.exports.useState(!1),[s,o]=d.exports.useState("1"),[i,E]=d.exports.useState([]),[p,y]=d.exports.useState({query:[],header:[],cookie:[],bodyFormData:[],bodyJSON:[]}),{global:v,envList:h}=l||{};d.exports.useEffect((()=>{if(!Array.isArray(v))return;const e=v.find((e=>"params"===e.type));e&&y(e.data);const t=v.find((e=>"var"===e.type));t&&E(t.data)}),[l,v]),d.exports.useEffect((()=>{p&&!1===n&&(p.bodyFormData&&Object.keys(p.bodyFormData).length>0||p.bodyJSON&&Object.keys(p.bodyJSON).length>0?o("2"):p.query&&p.query.length>0?o("1"):p.header&&p.header.length>0&&o("3"),r(!0))}),[p,n]);const b=(e,a)=>{const l=m(c({},p),{[e]:a});y(l),t(l,"params")};return"g1"===e?u.createElement(u.Fragment,null,u.createElement("div",{className:"title"},"全局变量"),u.createElement(ce,{tableData:i,size:"small",onEditChange:e=>((e,a)=>{E(e),t(e,a)})(e,"var")}),u.createElement(qe,null)):"g2"===e?u.createElement(u.Fragment,null,u.createElement("div",{className:"title"},"全局参数"),u.createElement(A,{activeKey:s,onChange:e=>o(e)},u.createElement(De,{tab:"Params",key:"1"},u.createElement(ce,{size:"small",tableData:p.query,tableTitle:"Query参数",onEditChange:e=>b("query",e)})),u.createElement(De,{tab:"Body",key:"2"},u.createElement(ce,{size:"small",tableData:p.bodyFormData,onEditChange:e=>b("bodyFormData",e)})),u.createElement(De,{tab:"Header",key:"3"},u.createElement(ce,{size:"small",tableData:p.header,onEditChange:e=>b("header",e)})),u.createElement(De,{tab:"Cookie",key:"4"},u.createElement(ce,{size:"small",tableData:p.cookie,onEditChange:e=>b("cookie",e)}))),u.createElement(qe,null)):u.createElement(we,{form:a,ckey:e,onChange:t,envList:h})}));var Te=e=>{const{visible:t,setVisible:a}=e,[l,n]=d.exports.useState("e1"),[r,s]=d.exports.useState({type:"",data:null}),{request:c,data:m={}}=H("/api/debugger/getGlobalVar",{lazy:!0}),{request:o,loading:i}=H("/api/debugger/saveGlobalVar",{lazy:!0});d.exports.useEffect((()=>{!0===t&&c()}),[t]);const[E]=O.useForm(),p=e=>{n(e)},y=()=>{a(!1)};return u.createElement(T,{title:"变量配置",width:1e3,visible:t,onCancel:y,onOk:()=>{const{type:e,data:t}=r,a={type:e,data:t};"e"===l.substr(0,1)?(E.submit(),E.validateFields().then((e=>{a.form=e,o(a).then((()=>{K.success("保存成功"),y()}))}))):o(a).then((()=>{K.success("保存成功"),y()}))},okText:"保存",cancelText:"取消",okButtonProps:{loading:i}},u.createElement("div",{className:"modal-env"},u.createElement("div",{className:"env-slider"},u.createElement("div",{className:"title"},"全局"),u.createElement("div",{className:"env-list"},u.createElement("div",{className:"env-list__item "+("g1"===l?"active":""),onClick:()=>p("g1")},u.createElement("span",{className:"name"},"全局变量")),u.createElement("div",{className:"env-list__item "+("g2"===l?"active":""),onClick:()=>p("g2")},u.createElement("span",{className:"name"},"全局参数"))),u.createElement("div",{className:"title"},"环境"),u.createElement("div",{className:"env-list"},u.createElement("div",{className:"env-list__item "+("e1"===l?"active":""),onClick:()=>p("e1")},u.createElement("span",{className:"name"},"开发环境")),u.createElement("div",{className:"env-list__item "+("e2"===l?"active":""),onClick:()=>p("e2")},u.createElement("span",{className:"name"},"测试环境")),u.createElement("div",{className:"env-list__item "+("e3"===l?"active":""),onClick:()=>p("e3")},u.createElement("span",{className:"name"},"生产环境")))),u.createElement("div",{className:"env-content"},u.createElement(Ie,{ckey:l,onChange:(e,t)=>{s({data:e,type:t})},form:E,globalData:m}))))};const{TabPane:Fe}=A,{Option:Ae}=F,ze=[{title:"项目概览",content:"Content of Tab Pane 1",key:"1"}];var Re=()=>{const e=U(),[t,a]=d.exports.useState([...ze]),[l,n]=d.exports.useState(!1),[r,s]=d.exports.useState(ze[0].key),[m,o]=d.exports.useState([]),[i,E]=d.exports.useState([]),{request:p,data:y,setData:v}=H("/api/debugger/getCurrentEnv"),{request:h}=H("/api/debugger/toggleEnv",{lazy:!0}),{data:b,request:g}=H("/api/debugger/getList"),{request:f,loading:k}=H("/api/debugger/remove",{lazy:!0});d.exports.useEffect((()=>{o(ie(b))}),[b]),d.exports.useEffect((()=>{const{hash:e}=window.location;if(e&&b){const t=e.substr(1);M(b,t,(e=>{x(e)}))}}),[b,e,e.location]);const N=e=>{"新建接口"!==e.title&&(window.location.hash=`${e.key}`)},x=e=>{const l=t[t.length-1];if(l.isNew&&e.title===l.title)return void s(l.key);e.key||(e.key="newTab"+t.length++);const n=t.find((t=>t&&t.key===e.key));if(n)s(n.key);else{const l=c({},e);a([...t,l].filter((e=>e&&e.key))),s(l.key)}N(e)},C=e=>{let l="",n=r;t.forEach(((t,a)=>{t.key===e&&(l=a-1)}));const c=t.filter((t=>t.key!==e));t.length&&r===e&&(n=l>=0?t[l].key:t[0].key),a([...c]),s(n)},S=e=>{v(e),h({env:e})},q=()=>u.createElement(D,{className:"operations prp10"},u.createElement(F,{value:y,style:{width:120},onChange:S},u.createElement(Ae,{value:"dev"},"开发环境"),u.createElement(Ae,{value:"test"},"测试环境"),u.createElement(Ae,{value:"prod"},"生产环境")),u.createElement("span",{className:"icon",onClick:()=>n(!0)},u.createElement($,null))),O=({pane:e})=>{if(g(),e&&e.isNew){const l=t.findIndex((t=>t.key===e.prevKey));l>-1&&(delete e.isNew,t.splice(l,1,e)),a([...t]),s(e.key),N(e)}},P=(e,t)=>{o((a=>Q(a,e,t))),E([...i,e])};return u.createElement("div",{className:"container-debugger"},u.createElement(te,{addPane:x,expandedKeys:i,list:m,removeItem:async e=>{if(e&&!k){await f({key:e}),g();t.findIndex((t=>t.key===e))>-1&&(a(t.filter((t=>t.key!==e))),r===e&&s("1"))}},removeLoading:k,onExpand:(e,{expanded:t,node:a})=>{console.log("xx",e,t,a)}}),u.createElement("div",{className:"container-content"},u.createElement(A,{className:"custom-tabs",hideAdd:!0,onChange:e=>{s(e)},onEdit:(e,t)=>{"remove"===t&&"string"==typeof e&&C(e)},activeKey:r,type:"editable-card",tabBarExtraContent:u.createElement(q,null)},t.map((e=>u.createElement(Fe,{tab:e.title,key:e.key},u.createElement("div",{className:"tab-content"},u.createElement(Se,{pane:e,env:y,onSaveSuccess:O,addChildTree:P}))))))),u.createElement(Te,{visible:l,setVisible:n}))};export{Re as default};
