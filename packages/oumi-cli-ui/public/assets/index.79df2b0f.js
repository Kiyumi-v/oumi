var e=Object.defineProperty,t=Object.defineProperties,a=Object.getOwnPropertyDescriptors,n=Object.getOwnPropertySymbols,r=Object.prototype.hasOwnProperty,s=Object.prototype.propertyIsEnumerable,l=(t,a,n)=>a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[a]=n,c=(e,t)=>{for(var a in t||(t={}))r.call(t,a)&&l(e,a,t[a]);if(n)for(var a of n(t))s.call(t,a)&&l(e,a,t[a]);return e},i=(e,n)=>t(e,a(n));import{G as o,R as d,L as m}from"./vendor.88f6b8e8.js";import{I as p,o as u,a as g,B as h,L as f,u as E,i as y,M as b,S as v,T as w}from"./index.f4db9373.js";import{F as N}from"./conductUtil.be5740f0.js";import{C as x,a as k}from"./CaretDownOutlined.b9003f40.js";import{P as j,T as I}from"./Tree.02029c52.js";import"./FolderOutlined.c8c19ab8.js";var S={icon:{tag:"svg",attrs:{viewBox:"0 0 1024 1024",focusable:"false"},children:[{tag:"path",attrs:{d:"M715.8 493.5L335 165.1c-14.2-12.2-35-1.2-35 18.5v656.8c0 19.7 20.8 30.7 35 18.5l380.8-328.4c10.9-9.4 10.9-27.6 0-37z"}}]},name:"caret-right",theme:"outlined"},C=function(e,t){return o.exports.createElement(p,Object.assign({},e,{ref:t,icon:S}))};C.displayName="CaretRightOutlined";var O=o.exports.forwardRef(C);const P=(e=8,t)=>{const a=[],n=t||"0123456789abcdef";for(let r=0;r<e;r++)a[r]=n.substr(Math.floor(Math.random()*n.length),1);return a.join("")};var L=e=>{const{onFinish:t}=e;return d.createElement(N,{name:"customized_form_controls",layout:"inline",onFinish:t},d.createElement(N.Item,{name:"name",label:"搜索",tooltip:{title:"首字母是“v”或包含中文表示搜索tag，否则就是搜索path",icon:d.createElement(u,null)}},d.createElement(g,{placeholder:"可搜索关键字、tag、路径",style:{width:230},allowClear:!0})),d.createElement(N.Item,null,d.createElement(h,{type:"primary",htmlType:"submit"},"搜索")))};const z=e=>{const{swaggerList:t,expandData:a={},expandCacheId:n,loadingId:r,onClickSwaggerHead:s,setSelectId:l,selectId:c}=e;return d.createElement("div",{className:"swagger-list"},t&&t.map((e=>d.createElement("div",{className:"swagger-list-item",key:e.id},d.createElement("div",{className:"heading",onClick:()=>s(e)},d.createElement("div",{className:"options"},r===e.id?d.createElement(f,null):n.includes(e.id)?d.createElement(x,null):d.createElement(O,null),n.includes(e.id)&&d.createElement("span",{className:"all",onClick:t=>((e,t)=>{const n=Object.keys(a[t.id]||{});c.includes(n[0])?l(c.filter((e=>!n.includes(e)))):l([...c,...n]),e.stopPropagation(),e.preventDefault()})(t,e)},"全选")),d.createElement("h3",null,e.name)),n.includes(e.id)&&d.createElement("div",{className:"content"},d.createElement("ul",{className:"content-list"},a&&a[e.id]&&Object.keys(a[e.id]).map((t=>{const n=a[e.id][t];return d.createElement("li",{className:`${n.methods||"get"}`,key:t},d.createElement("span",{className:"checkbox"},d.createElement(k,{value:t,onChange:()=>(e=>{c.includes(e)?l(c.filter((t=>t!==e))):l([...c,e])})(t),checked:c.includes(t)})),d.createElement("span",{className:"methods"},(n.methods||"get").toLocaleUpperCase()),d.createElement("span",{className:"path"},t),d.createElement("span",{className:"desc",title:n.description},n.description))}))))))))};var A=e=>{const{selectNode:t,onSuccess:a}=e,{dirPath:n}=t||{},[r]=N.useForm(),[s,l]=d.useState(!1),{data:i,request:o,loading:m}=E("/api/project/createDir",{lazy:!0}),p=e=>{l(e)};return d.createElement(j,{title:()=>d.createElement("div",null,d.createElement(N,{form:r,className:"my-popconfirm-form"},d.createElement(N.Item,{name:"dirName",label:"目录名称",rules:[{required:!0,message:"请输入目录名称"},{pattern:/^[a-zA-Z0-9_-]+$/,message:"请输入正确的目录名称"}]},d.createElement(g,null)))),visible:s,onConfirm:()=>{r.validateFields().then((e=>{o(c({currentPath:n},e)).then((e=>{l(!1),"function"==typeof a&&a()}))}))},placement:"left",okButtonProps:{loading:m},onCancel:()=>p(!1),icon:!1},d.createElement(h,{size:"small",type:"primary",disabled:!t,onClick:()=>p(!0)},"新建文件夹"))};function D(e,t,a){return e.map((e=>e.key===t?i(c({},e),{children:a}):e.children?i(c({},e),{children:D(e.children,t,a)}):e))}var T=e=>{const{selectId:t,configId:a}=e,[n,r]=o.exports.useState([]),[s,l]=o.exports.useState(null),{data:c,loading:i,request:m}=E("/api/swagger/build",{lazy:!0}),p=e=>y.post("/api/project/dirs",e),u=()=>{p().then((e=>{r(e)}))};function g({key:e,children:t,dirPath:a}){return new Promise((n=>{t?n():p({currentPath:a}).then((t=>{Array.isArray(t)&&r((a=>D(a,e,t))),n()}))}))}o.exports.useEffect((()=>{u()}),[]);return d.createElement("div",{className:"dirs"},d.createElement("div",{className:"dirs-box"},d.createElement("div",{className:"dirs-head"},"当前项目目录："),d.createElement(A,{selectNode:s,onSuccess:()=>{s&&s.key?g({key:s.key,dirPath:s.key}):u()}}),d.createElement(I,{showLine:!0,showIcon:!0,loadData:g,treeData:n,onSelect:(e,t)=>{const{selected:a,node:n}=t,{isLeaf:r}=n;l(a&&!r?n:null)}})),d.createElement("div",{className:"dirs-btn"},d.createElement(h,{type:"primary",disabled:!s,onClick:()=>{if(t.length<=0&&b.warn("请选择需要导出的api"),s&&t.length>0){const{dirPath:e}=s;m({outputPath:e,searchContent:t,configId:a}).then((e=>{b.success("生成文件成功~")}))}},loading:i},"生成接口到目录")))};const{TabPane:F}=w,q=e=>d.createElement("div",{className:"ui-swagger-content"},d.createElement("div",{className:"top-header"},d.createElement("h2",null,"Swagger")),d.createElement("div",{className:"ui-content-container ui-swagger-container"},e.children)),M=()=>d.createElement(q,null,d.createElement("div",{className:"swagger-error"},"您当前还没有配置Swagger，去 ",d.createElement(m,{to:"/dashboard/config"},"配置")," 。"));export default()=>{const[e,t]=o.exports.useState(""),{data:a,error:n,loading:r}=E("/api/config/swagger/get"),{data:s,loading:l,request:m,source:p}=E("/api/swagger/info",{lazy:!0}),{request:u}=E("/api/swagger/search",{lazy:!0}),[g,h]=o.exports.useState([]),[f,y]=o.exports.useState({}),[N,x]=o.exports.useState(""),[k,j]=o.exports.useState([]),[I,S]=o.exports.useState([]);o.exports.useEffect((()=>()=>{p.cancel()}),[]),o.exports.useEffect((()=>{a&&a.length>0&&t(a[0].id)}),[a]),o.exports.useEffect((()=>{s&&Array.isArray(s.tags)&&h(s.tags.map((e=>i(c({},e),{id:P(8)}))))}),[s]),o.exports.useEffect((()=>{e&&m({id:e})}),[e]);return r?d.createElement(q,null,d.createElement(v,null)):n||!Array.isArray(a)||0===a.length?d.createElement(M,null):d.createElement(q,null,d.createElement(w,{type:"card",defaultActiveKey:e,onTabClick:e=>{t(e)}},a&&a.map((e=>d.createElement(F,{tab:e.name,key:e.id})))),d.createElement("div",{className:"tabs-content"},l&&d.createElement("div",{className:"fetch-loading"},d.createElement(v,null)),d.createElement("div",{className:"flex align-items"},d.createElement(L,{onFinish:t=>{const{name:a}=t;if(a){const t=P(8);h([{name:a,description:"",id:t}]),j([t]),x(t),S([]);const n=/[\u4e00-\u9fa5]+/g,r=a.toLocaleUpperCase().startsWith("V")||n.test(a)?{searchTag:a}:{searchPath:a};u(c({configId:e},r)).then((e=>{if(x(""),"object"==typeof e&&Object.keys(e||{}).length>0){const a={};Object.keys(e).forEach((t=>{a[t]={description:e[t].description,methods:e[t].methods}})),y({[t]:a})}else b.warning("没有数据")}))}else m({id:e})}}),d.createElement("div",{className:"plp2"},"已选中",I.length,"个")),d.createElement("div",{className:"body-flex"},d.createElement(z,{selectId:I,setSelectId:S,swaggerList:g,loadingId:N,expandCacheId:k,expandData:f,onClickSwaggerHead:t=>{k.includes(t.id)?j(k.filter((e=>e!==t.id))):f[t.id]?j([...k,t.id]):(x(t.id),u({configId:e,searchTag:t.name}).then((e=>{if(x(""),"object"==typeof e&&Object.keys(e||{}).length>0){const a={};Object.keys(e).forEach((t=>{a[t]={description:e[t].description,methods:e[t].methods}})),j([...k,t.id]),y(i(c({},f),{[t.id]:a}))}else b.warning("没有数据")})))}}),d.createElement(T,{selectId:I,configId:e}))))};
