var ce=Object.defineProperty,ue=Object.defineProperties;var oe=Object.getOwnPropertyDescriptors;var X=Object.getOwnPropertySymbols;var ie=Object.prototype.hasOwnProperty,me=Object.prototype.propertyIsEnumerable;var Y=(t,s,n)=>s in t?ce(t,s,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[s]=n,v=(t,s)=>{for(var n in s||(s={}))ie.call(s,n)&&Y(t,n,s[n]);if(X)for(var n of X(s))me.call(s,n)&&Y(t,n,s[n]);return t},T=(t,s)=>ue(t,oe(s));import{R as e,W as q,X as Q,I as ee,Y as W,r as g,M as J,Z as de,A as pe,_ as Ee,z as fe,C as ge,$ as te,a0 as he,a1 as Fe,D as ye,a2 as Ce,a3 as be,J as ae,T as U,f as M,a4 as G,a5 as De,O as Se,a6 as ve,m as H,a7 as we,a8 as Ne,L as xe}from"./vendor.25eb60fb.js";import{a as Ae,u as I,i as ke}from"./index.22863799.js";import{c as ne,a as Te}from"./index.03ffb951.js";import{C as Z}from"./index.6c8aecb8.js";import{C as B}from"./index.71b5dd22.js";const Ie=["string","number","array","object","integer","boolean","int32","int64","ref","file"],je=t=>(t.type&&typeof t.type=="string"||(t.type=t.schema&&t.schema.type,t.type&&(t.schema&&delete t.schema,typeof t.in=="string"&&delete t.in)),t);function qe(t){if(!t)return!1;const s=t.type||t.schema&&t.schema.type;return s?Ie.includes(s):!1}function Be(t){return t&&Object.prototype.toString.call(t)==="[object Object]"&&Object.keys(t).length>0}function se(t,s){const n={};function c(m,o){Array.isArray(o)?o.forEach(l=>{console.log("\u6570\u7EC4\u7684\u6682\u6CA1\u6709\u5904\u7406~")}):Be(o)&&Object.keys(o).forEach(l=>{const d=v({},o[l]);if(d.isArray){delete d.isArray;const h={};c(h,d),m[l]=[h]}else if(qe(d))m[l]=Oe(d,s);else{if(Number(l)===0)return;m[l]={},c(m[l],d)}})}return c(n,t),n}const R=(t,s,n)=>{const{resultValueType:c="type"}=n||{},{example:m,description:o}=t;return c==="type"?s:m||o||s};function Oe(t,s){je(t);const{type:n,items:c,example:m}=t;if(m)return m;const o=c&&c.type?c.type:n;if(n==="array"){if(o==="integer"||o==="number")return R(t,[1],s);if(o==="string")return R(t,["1"],s)}return n==="integer"||n==="number"?R(t,1,s):n==="string"?R(t,"string",s):n==="boolean"?R(t,!0,s):R(t,n,s)}var Pe=t=>{const{onFinish:s,form:n}=t;return e.createElement(q,{form:n,name:"customized_form_controls",layout:"inline",onFinish:s},e.createElement(q.Item,{name:"name",label:"\u641C\u7D22",tooltip:{title:"\u9996\u5B57\u6BCD\u662F\u201Cv\u201D\u6216\u5305\u542B\u4E2D\u6587\u8868\u793A\u641C\u7D22tag\uFF0C\u5426\u5219\u5C31\u662F\u641C\u7D22path",icon:e.createElement(Q,null)}},e.createElement(ee,{placeholder:"\u53EF\u641C\u7D22\u5173\u952E\u5B57\u3001tag\u3001\u8DEF\u5F84",style:{width:230},allowClear:!0})),e.createElement(q.Item,null,e.createElement(W,{type:"primary",htmlType:"submit"},"\u641C\u7D22")))};const{TabPane:_}=U,Re=t=>{const{swaggerList:s,expandData:n={},expandCacheId:c,loadingId:m,onClickSwaggerHead:o,setSelectId:l,selectId:d,tabsId:h}=t,[w,x]=g.exports.useState(!1),[a,F]=g.exports.useState(null),[b,j]=g.exports.useState("1"),{downloadFile:D}=Ae(),{request:E,loading:S}=I("/api/export/json",{lazy:!0,methods:"get"}),{request:C,loading:y}=I("/api/export/typescript",{lazy:!0,methods:"get"}),{request:A,loading:L}=I("/api/export/mock",{lazy:!0,methods:"get"}),z=(r,i)=>{const f=Object.keys(n[i.id]||{});d.includes(f[0])?l(d.filter(le=>!f.includes(le))):l([...d,...f]),r.stopPropagation(),r.preventDefault()},V=r=>{d.includes(r)?l(d.filter(i=>i!==r)):l([...d,r])},$=r=>{x(r)},u=(r,i)=>{$(!0),j("1"),F(null),setTimeout(()=>{F(T(v({},r),{key:i}))},200)},p=r=>{!r||D("/api/export/json",{params:{id:h,searchPath:r}})},N=r=>{!r||D("/api/export/typescript",{params:{id:h,searchPath:r}})},O=r=>{!r||D("/api/export/mock",{params:{id:h,searchPath:r}})},k=()=>e.createElement(e.Fragment,null,a&&a.methods==="post"&&e.createElement(G,{color:"green"},"POST"),a&&a.methods==="get"&&e.createElement(G,{color:"blue"},"GET"),a&&a.methods==="delete"&&e.createElement(G,{color:"red"},"DELETE"),a&&a.methods==="put"&&e.createElement(G,{color:"volcano"},"PUT")),P=r=>{j(r);const i={isDownload:0,id:h,searchPath:a==null?void 0:a.key};r==="3"&&!a.code_Response&&E(i).then(f=>{F(T(v({},a),{code_Response:f}))}),r==="4"&&!a.code_Mock&&A(i).then(f=>{F(T(v({},a),{code_Mock:f}))}),r==="5"&&!a.code_TS&&C(i).then(f=>{F(T(v({},a),{code_TS:f}))})},K=e.createElement(J,null,e.createElement(J.Item,{onClick:()=>p(a&&a.key)},e.createElement("span",null,e.createElement(de,null)," \u5BFC\u51FA Response")),e.createElement(J.Item,{onClick:()=>O(a&&a.key)},e.createElement("span",null,e.createElement(pe,null)," \u5BFC\u51FA Mock")),e.createElement(J.Item,{onClick:()=>N(a&&a.key)},e.createElement("span",null,e.createElement(Ee,null)," \u5BFC\u51FA TS")));return e.createElement("div",{className:"swagger-list"},s&&s.map(r=>e.createElement("div",{className:"swagger-list-item",key:r.id},e.createElement("div",{className:"heading",onClick:()=>o(r)},e.createElement("div",{className:"options"},(()=>m===r.id?e.createElement(fe,null):c.includes(r.id)?e.createElement(ge,null):e.createElement(te,null))(),c.includes(r.id)&&e.createElement("span",{className:"all",onClick:i=>z(i,r)},"\u5168\u9009")),e.createElement("h3",null,r.name)),c.includes(r.id)&&e.createElement("div",{className:"content"},e.createElement("ul",{className:"content-list"},n&&n[r.id]&&Object.keys(n[r.id]).map(i=>{const f=n[r.id][i];return e.createElement("li",{className:`${f.methods||"get"}`,key:i},e.createElement("span",{className:"checkbox"},e.createElement(he,{value:i,onChange:()=>V(i),checked:d.includes(i)})),e.createElement("span",{className:"methods"},(f.methods||"get").toLocaleUpperCase()),e.createElement("span",{className:"path",onClick:()=>u(f,i)},i),e.createElement("span",{className:"desc",title:f.description,onClick:()=>u(f,i)},f.description),e.createElement("span",{className:"bg"},e.createElement(te,null)))}))))),e.createElement(Fe,{title:e.createElement("span",null,e.createElement(k,null)," ",a&&(a.description||a.key)||""),placement:"right",closable:!1,onClose:()=>$(!1),visible:w,width:880,extra:e.createElement("div",{style:{paddingRight:50}},e.createElement(ye,{overlay:K},e.createElement("a",{className:"ant-dropdown-link",onClick:r=>r.preventDefault()},e.createElement(Ce,null)," \u5BFC\u51FA\u6570\u636E ",e.createElement(be,null))))},e.createElement("div",{style:{position:"relative",top:-10,overflow:"hidden"}},e.createElement(ae,null,"\u8DEF\u5F84:",a&&a.key)),e.createElement(U,{className:"tabs-oumi",activeKey:b,type:"card",onTabClick:P,style:{marginBottom:32}},e.createElement(_,{tab:"\u9ED8\u8BA4",key:"1",forceRender:!1},e.createElement("h3",{className:"mbm5"},"\u8BF7\u6C42\u5934\uFF08Request\uFF09\uFF1A"),e.createElement(B,{code:a&&se(a.request,{resultValueType:"type"})}),e.createElement("h3",{className:"mbm5"},"\u54CD\u5E94\uFF08Response\uFF09\uFF1A"),e.createElement(B,{code:a&&se(a.response,{resultValueType:"desc"})})),e.createElement(_,{tab:"\u8BE6\u7EC6",key:"2",forceRender:!1},e.createElement("h3",{className:"mbm5"},"\u8BF7\u6C42\u5934\uFF08Request\uFF09\uFF1A"),e.createElement(B,{code:a&&a.request}),e.createElement("h3",{className:"mbm5"},"\u54CD\u5E94\uFF08Response\uFF09\uFF1A"),e.createElement(B,{code:a&&a.response})),e.createElement(_,{tab:"Response",key:"3"},S&&e.createElement(M,null),e.createElement(B,{code:a==null?void 0:a.code_Response,isCopy:!0})),e.createElement(_,{tab:"Mock",key:"4"},L&&e.createElement(M,null),e.createElement(B,{code:a==null?void 0:a.code_Mock,lang:"javascript",isCopy:!0})),e.createElement(_,{tab:"TypeScript",key:"5"},y&&e.createElement(M,null),e.createElement(B,{code:a==null?void 0:a.code_TS,lang:"javascript",isCopy:!0})))))};var Le=Re,Me=t=>{const{selectNode:s,onSuccess:n}=t,{dirPath:c}=s||{},[m]=q.useForm(),[o,l]=e.useState(!1),{data:d,request:h,loading:w}=I("/api/project/createDir",{lazy:!0}),x=b=>{l(b)},a=()=>{m.validateFields().then(b=>{h(v({currentPath:c},b)).then(j=>{l(!1),typeof n=="function"&&n()})})},F=()=>e.createElement("div",null,e.createElement(q,{form:m,className:"my-popconfirm-form"},e.createElement(q.Item,{name:"dirName",label:"\u76EE\u5F55\u540D\u79F0",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u76EE\u5F55\u540D\u79F0"},{pattern:/^[a-zA-Z0-9_-]+$/,message:"\u8BF7\u8F93\u5165\u6B63\u786E\u7684\u76EE\u5F55\u540D\u79F0"}]},e.createElement(ee,null))));return e.createElement(De,{title:F,visible:o,onConfirm:a,placement:"top",okButtonProps:{loading:w},onCancel:()=>x(!1),icon:!1},e.createElement(W,{size:"middle",disabled:!s,onClick:()=>x(!0)},"\u65B0\u5EFA\u6587\u4EF6\u5939"))};const{DirectoryTree:_e}=ve;function re(t,s,n){return t.map(c=>c.key===s?T(v({},c),{children:n}):c.children?T(v({},c),{children:re(c.children,s,n)}):c)}var ze=t=>{const{selectId:s,setSelectId:n,configId:c}=t,[m,o]=g.exports.useState([]),[l,d]=g.exports.useState(null),{data:h,loading:w,request:x}=I("/api/swagger/build",{lazy:!0}),a=E=>ke.post("/api/project/dirs",E),F=()=>{a().then(E=>{o(E)})};g.exports.useEffect(()=>{F()},[]);function b({key:E,children:S,dirPath:C}){return new Promise(y=>{if(S){y();return}a({currentPath:C}).then(A=>{Array.isArray(A)&&o(L=>re(L,E,A)),y()})})}const j=(E,S)=>{const{selected:C,node:y}=S,{isLeaf:A}=y;d(C&&!A?y:null)},D=()=>{if(s.length<=0&&H.warn("\u8BF7\u9009\u62E9\u9700\u8981\u5BFC\u51FA\u7684api"),l&&s.length>0){const{dirPath:E}=l;x({outputPath:E,searchContent:s,configId:c}).then(S=>{H.success("\u751F\u6210\u6587\u4EF6\u6210\u529F~"),n([])})}};return e.createElement("div",{className:"dirs"},e.createElement("div",{className:"dirs-box"},e.createElement("div",{className:"dirs-head"},"\u751F\u6210\u63A5\u53E3\u5230\u76EE\u5F55"," ",e.createElement(Se,{title:"\u751F\u6210\u63A5\u53E3\u7684\u89C4\u5219\u5728\u914D\u7F6E\u4E2D\u5FC3\u4FEE\u6539"},e.createElement(Q,null)),"\uFF1A"),e.createElement(_e,{loadData:b,treeData:m,onSelect:j})),e.createElement("div",{className:"dirs-btn"},e.createElement(ae,null,e.createElement(W,{type:"primary",size:"middle",disabled:!l,onClick:D,loading:w},"\u751F\u6210\u63A5\u53E3\u5230\u76EE\u5F55"),e.createElement(Me,{selectNode:l,onSuccess:()=>{l&&l.key?b({key:l.key,dirPath:l.key}):F()}}))))},Ve=t=>{const s=[],{paths:n}=t;return Object.keys(n).forEach(c=>{const m=n[c],o=m.get||m.post||m.delete||m.put;if(o){const{tags:l}=o;Array.isArray(l)&&l.forEach(d=>{s.some(w=>w.name===d)||s.push({name:d,description:m.summary,id:ne(10)})})}else console.warn(o)}),s.sort(Te("name"))};const{TabPane:$e}=U,Ke=()=>e.createElement(Z,{title:"Swagger"},e.createElement("div",{className:"swagger-error"},"\u60A8\u5F53\u524D\u8FD8\u6CA1\u6709\u914D\u7F6ESwagger\uFF0C\u53BB ",e.createElement(xe,{to:"/config"},"\u914D\u7F6E")," \u3002"));var Xe=g.exports.memo(()=>{const[t,s]=g.exports.useState(""),{data:n,error:c,loading:m}=I("/api/config/swagger/get"),[o]=q.useForm(),{data:l,loading:d,request:h}=I("/api/swagger/info",{lazy:!0}),{request:w}=I("/api/swagger/search",{lazy:!0}),[x,a]=g.exports.useState([]),[F,b]=g.exports.useState({}),[j,D]=g.exports.useState(""),[E,S]=g.exports.useState([]),[C,y]=g.exports.useState([]);g.exports.useEffect(()=>{n&&n.length>0&&s(n[0].id)},[n]),g.exports.useEffect(()=>{l&&Array.isArray(l.tags)&&a(Ve(l))},[l]),g.exports.useEffect(()=>{if(t){const u=o.getFieldValue("name");y([]),u?z({name:u}):h({id:t})}},[t]);const A=u=>{s(u)},L=u=>{if(E.includes(u.id)){S(E.filter(p=>p!==u.id));return}if(F[u.id]){S([...E,u.id]);return}D(u.id),w({configId:t,searchTag:u.name}).then(p=>{if(D(""),typeof p=="object"&&Object.keys(p||{}).length>0){const N={};Object.keys(p).forEach(O=>{const k=p[O];N[O]={description:k.description,methods:k.methods,request:k.request,response:k.response}}),S([...E,u.id]),b(T(v({},F),{[u.id]:N}))}else H.warning("\u6CA1\u6709\u6570\u636E")}).catch(()=>{D("")})},z=u=>{const{name:p}=u;if(p===void 0||p==="")h({id:t});else{const N=ne(8);a([{name:p,description:"",id:N}]),S([N]),D(N);const O=/[\u4e00-\u9fa5]+/g,k=p.toLocaleUpperCase().startsWith("V")||O.test(p)?{searchTag:p}:{searchPath:p};w(v({configId:t},k)).then(P=>{if(D(""),typeof P=="object"&&Object.keys(P||{}).length>0){const K={};Object.keys(P).forEach(r=>{const i=P[r];K[r]={description:i.description,methods:i.methods,request:i.request,response:i.response}}),b({[N]:K})}else H.warning("\u6CA1\u6709\u6570\u636E")})}};if(m)return e.createElement(Z,{title:"Swagger"},e.createElement(M,null));if(c||!Array.isArray(n)||n.length===0)return e.createElement(Ke,null);const V=u=>{y(u?C.filter(p=>p!==u):[])},$=e.createElement("div",{className:"popover-selected"},e.createElement("a",{onClick:()=>V()},"\u6E05\u7A7A\u6240\u6709"),C&&C.map(u=>e.createElement("p",{key:u},u," ",e.createElement("span",{onClick:()=>V(u),title:"\u79FB\u9664"},e.createElement(we,null)))));return e.createElement(Z,{isMain:!0,title:"Swagger",className:"ui-swagger-container"},e.createElement(U,{className:"tabs-oumi",type:"card",defaultActiveKey:t,onTabClick:A},n&&n.map(u=>e.createElement($e,{tab:u.name,key:u.id}))),e.createElement("div",{className:"tabs-content"},d&&e.createElement("div",{className:"fetch-loading"},e.createElement(M,null)),e.createElement("div",{className:"selected flex align-items"},e.createElement(Pe,{form:o,onFinish:z}),e.createElement(Ne,{content:$,title:"\u5DF2\u9009\u4E2D",placement:"bottom"},e.createElement("div",{className:"plp2"},"\u5DF2\u9009\u4E2D",e.createElement("span",{className:"span"},C.length),"\u4E2A"))),e.createElement("div",{className:"body-flex"},e.createElement(Le,{tabsId:t,selectId:C,setSelectId:y,swaggerList:x,loadingId:j,expandCacheId:E,expandData:F,onClickSwaggerHead:L}),e.createElement(ze,{selectId:C,setSelectId:y,configId:t}))))});export{Xe as default};
