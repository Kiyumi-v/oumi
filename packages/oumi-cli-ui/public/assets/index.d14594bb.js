var e=Object.defineProperty,t=Object.defineProperties,a=Object.getOwnPropertyDescriptors,n=Object.getOwnPropertySymbols,r=Object.prototype.hasOwnProperty,s=Object.prototype.propertyIsEnumerable,l=(t,a,n)=>a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[a]=n;import{r as c,R as o,ae as i,X as p,J as m,O as d,ao as u,ap as E,a5 as g,aq as v,I as f,ar as y,as as _,e as h,T as b}from"./vendor.4b163024.js";import{C as k}from"./index.982655a1.js";import{b as x,u as P}from"./index.28e8633a.js";import{a as j}from"./event.a08fa5cc.js";var N=c.exports.memo((({list:e,updatePackage:v,removePackage:f,onProgress:y})=>{const{socket:_}=x();c.exports.useEffect((()=>(_.on("progress_changed",(e=>{if(e&&e.progressChanged&&e.progressChanged.args){const{progress:t,status:a,args:n}=e.progressChanged;if(void 0===t||-1===t)return;const r={progress:t,status:a,name:n[0]};y(r)}})),_.on("progress_removed",(e=>{y({progress:-1,status:"",name:""})})),_.on("uninstall_dep_done",(e=>{f(e)})),_.on("update_dep_done",(e=>{v(e)})),()=>{_.off("progress_changed"),_.off("progress_removed"),_.off("uninstall_dep_done"),_.off("update_dep_done")})),[]);const h=e=>{const c=(o=((e,t)=>{for(var a in t||(t={}))r.call(t,a)&&l(e,a,t[a]);if(n)for(var a of n(t))s.call(t,a)&&l(e,a,t[a]);return e})({},e),t(o,a({progress:0})));var o;y(c)};return o.createElement("div",{className:"wrapper-deps-list"},o.createElement("div",{className:"deps-list"},o.createElement("ul",null,e&&e.map((e=>o.createElement("li",{key:e.id},o.createElement("div",{className:"deps-logo"},o.createElement("img",{src:e.avatars,alt:""})),o.createElement("div",{className:"deps-content"},o.createElement("div",{className:"name"},e.id),o.createElement("div",{className:"description"},o.createElement("span",null,"当前 ",o.createElement("small",null,e.current)),o.createElement("span",null,"最新 ",o.createElement("small",null,e.latest)),o.createElement("span",null,o.createElement("span",null,e.installed&&o.createElement(o.Fragment,null,o.createElement(i,null)," 已安装"),!e.installed&&o.createElement(o.Fragment,null,o.createElement(p,null)," 未安装")),o.createElement("a",{href:e.website,target:"_blank",className:"link"},"查看详情")))),o.createElement("div",{className:"deps-button"},o.createElement(m,null,e.installed?e.current!=e.latest?o.createElement(d,{placement:"top",title:`更新 ${e.id}`},o.createElement(E,{onClick:()=>{return t=e.id,h({status:"dependency-update",name:t}),void _.emit("update_dep",{id:t});var t}})):null:o.createElement(d,{placement:"top",title:`安装 ${e.id}`},o.createElement(u,{onClick:()=>{return t=e.id,h({status:"dependency-install",name:t}),void _.emit("install_dep",{id:t,type:"devDependencies"});var t}})),o.createElement(d,{placement:"top",title:`移除 ${e.id}`},o.createElement(g,{onClick:()=>{return t=e.id,h({status:"dependency-uninstall",name:t}),void _.emit("uninstall_dep",{id:t});var t}}))))))))))}));function S(e,t=300){let a=null;return(...n)=>{clearTimeout(a),a=setTimeout((()=>{e.apply(null,n)}),t)}}var w=e=>{const{installPackage:t}=e,{request:a,data:n}=P("/api/npm/search",{lazy:!0}),[r,s]=c.exports.useState([]),[l,i]=c.exports.useState([]);return o.createElement("div",{className:""},o.createElement(v,{dropdownMatchSelectWidth:252,style:{width:300},options:r,onSelect:e=>{const a=l.find((t=>t.name===e));t(e,null==a?void 0:a.version)},onSearch:S((async e=>{if(!e||e.length<2)return;const t=await a({name:e});if(Array.isArray(t)){const e=[];t.forEach((t=>{e.push({name:t.name,version:t.version,description:t.description,link:t.links&&t.links.homepage})})),i(e),s(e.map(((e,t)=>{const{link:a,name:n,description:r,version:s}=e;return{value:n,label:o.createElement("div",{style:{display:"flex",justifyContent:"space-between"}},o.createElement("span",null,n,o.createElement("small",null,"  ",o.createElement("a",{href:a,target:"_blank",rel:"noopener noreferrer"},o.createElement(y,null)))),o.createElement("span",null,s))}})))}}))},o.createElement(f.Search,{size:"middle",allowClear:!0,placeholder:"安装依赖",enterButton:!0})))};const{TabPane:C}=b,O=[];var D=()=>{const{socket:e}=x(),[t,a]=c.exports.useState(500),[n,r]=c.exports.useState("2"),[s,l]=c.exports.useState(!1),[i,p]=c.exports.useState({progress:-1,status:"",name:""}),[m,d]=c.exports.useState([]);j((()=>{d([...O])}),t),c.exports.useEffect((()=>(l(!0),e.emit("get_project_deps"),e.on("get_project_deps",(e=>{O.find((t=>t.id===e.data.id))||O.push(e.data)})),e.on("get_project_deps_done",(()=>{a(null),l(!1),d([...O])})),()=>{e.off("get_project_deps"),e.off("get_project_deps_done"),a(null),O.length=0})),[]);const u=({id:e,version:t,versionRange:a,type:n})=>{const r=O.find((t=>t.id===e));r&&(r.current=a||t,d([...O]))},E=({id:e,type:t})=>{const a=O.findIndex((t=>t.id===e));a>-1&&(O.splice(a,1),d([...O]))},g=e=>{p(e)},v=c.exports.useMemo((()=>m.filter((e=>"devDependencies"!==e.type))),[m]),f=c.exports.useMemo((()=>m.filter((e=>"devDependencies"===e.type))),[m]);return o.createElement(k,{isMain:!0,title:"项目依赖",className:"deps-container"},-1!==i.progress&&o.createElement("div",{className:"progress"},o.createElement("div",null,o.createElement(_,{type:"circle",percent:Math.ceil(63*i.progress)}),o.createElement("p",{className:"red"},i.name,": ",i.status))),o.createElement("div",{className:"deps-header mbm10"},o.createElement(w,{installPackage:(t,a)=>{e.emit("install_dep",{id:t,type:"2"===n?"devDependencies":""}),g({progress:0,status:"",name:t})}}),o.createElement("div",{className:"info"},s&&o.createElement("span",null,o.createElement(h,null))," ","依赖 ",m&&o.createElement("span",null,m.length," 个"))),o.createElement("div",{className:"rel"},o.createElement(b,{className:"tabs-oumi",activeKey:n,type:"card",onChange:e=>r(e)},o.createElement(C,{tab:"运行依赖",key:"1",forceRender:!1},o.createElement(N,{list:v,updatePackage:u,removePackage:E,onProgress:g})),o.createElement(C,{tab:"开发依赖",key:"2",forceRender:!1},o.createElement(N,{list:f,updatePackage:u,removePackage:E,onProgress:g})))))};export{D as default};
