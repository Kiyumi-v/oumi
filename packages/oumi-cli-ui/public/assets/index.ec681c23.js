var e=Object.defineProperty,t=Object.defineProperties,a=Object.getOwnPropertyDescriptors,r=Object.getOwnPropertySymbols,n=Object.prototype.hasOwnProperty,s=Object.prototype.propertyIsEnumerable,l=(t,a,r)=>a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[a]=r,c=(e,t)=>{for(var a in t||(t={}))n.call(t,a)&&l(e,a,t[a]);if(r)for(var a of r(t))s.call(t,a)&&l(e,a,t[a]);return e},i=(e,r)=>t(e,a(r));import{R as o,W as m,X as d,I as p,Y as u,r as E,z as g,C as f,Z as y,_ as h,$ as b,J as k,O as v,a0 as N,a1 as x,a2 as w,T as S,a3 as C,a4 as j,m as I,e as P,a5 as O,a6 as T,L as A}from"./vendor.700af4c2.js";import{a as q,u as z,i as D}from"./index.20db010a.js";import{c as F,a as R}from"./index.03ffb951.js";import{C as L}from"./index.6edc5c76.js";import{C as V}from"./index.cdbd58df.js";const _=["string","number","array","object","integer","boolean","int32","int64","ref","file"];function U(e,t){const a={};return function e(a,r){Array.isArray(r)?r.forEach((e=>{console.log("数组的暂没有处理~")})):r&&"object"==typeof r&&Object.keys(r).forEach((n=>{const s=c({},r[n]);if(s.isArray){delete s.isArray;const t={};e(t,s),a[n]=[t]}else if((l=s)&&void 0!==l.type&&_.includes(l.type))a[n]=function(e,t){const{type:a,items:r,explame:n}=e;if(n)return n;const s=r&&r.type?r.type:a;if("array"===a){if("integer"===s||"number"===s)return $(e,[1],t);if("string"===s)return $(e,["1"],t)}if("integer"===a||"number"===a)return $(e,1,t);if("string"===a)return $(e,"string",t);if("boolean"===a)return $(e,!0,t);return $(e,a,t)}(s,t);else{if(0===Number(n))return;a[n]={},e(a[n],s)}var l}))}(a,e),a}const $=(e,t,a)=>{const{resultValueType:r="type"}=a||{},{explame:n,description:s}=e;return"type"===r?t:n||s||t};var B=e=>{const{onFinish:t,form:a}=e;return o.createElement(m,{form:a,name:"customized_form_controls",layout:"inline",onFinish:t},o.createElement(m.Item,{name:"name",label:"搜索",tooltip:{title:"首字母是“v”或包含中文表示搜索tag，否则就是搜索path",icon:o.createElement(d,null)}},o.createElement(p,{placeholder:"可搜索关键字、tag、路径",style:{width:230},allowClear:!0})),o.createElement(m.Item,null,o.createElement(u,{type:"primary",htmlType:"submit"},"搜索")))};const{TabPane:H}=S;var K=e=>{const{swaggerList:t,expandData:a={},expandCacheId:r,loadingId:n,onClickSwaggerHead:s,setSelectId:l,selectId:m,tabsId:d}=e,[p,C]=E.exports.useState(!1),[j,I]=E.exports.useState(null),[P,O]=E.exports.useState("1"),{downloadFile:T}=q(),A=e=>{C(e)},z=(e,t)=>{A(!0),O("1"),I(null),setTimeout((()=>{I(i(c({},e),{key:t}))}),200)};return o.createElement("div",{className:"swagger-list"},t&&t.map((e=>o.createElement("div",{className:"swagger-list-item",key:e.id},o.createElement("div",{className:"heading",onClick:()=>s(e)},o.createElement("div",{className:"options"},n===e.id?o.createElement(g,null):r.includes(e.id)?o.createElement(f,null):o.createElement(y,null),r.includes(e.id)&&o.createElement("span",{className:"all",onClick:t=>((e,t)=>{const r=Object.keys(a[t.id]||{});m.includes(r[0])?l(m.filter((e=>!r.includes(e)))):l([...m,...r]),e.stopPropagation(),e.preventDefault()})(t,e)},"全选")),o.createElement("h3",null,e.name)),r.includes(e.id)&&o.createElement("div",{className:"content"},o.createElement("ul",{className:"content-list"},a&&a[e.id]&&Object.keys(a[e.id]).map((t=>{const r=a[e.id][t];return o.createElement("li",{className:`${r.methods||"get"}`,key:t},o.createElement("span",{className:"checkbox"},o.createElement(h,{value:t,onChange:()=>(e=>{m.includes(e)?l(m.filter((t=>t!==e))):l([...m,e])})(t),checked:m.includes(t)})),o.createElement("span",{className:"methods"},(r.methods||"get").toLocaleUpperCase()),o.createElement("span",{className:"path",onClick:()=>z(r,t)},t),o.createElement("span",{className:"desc",title:r.description,onClick:()=>z(r,t)},r.description),o.createElement("span",{className:"bg"},o.createElement(y,null)))}))))))),o.createElement(b,{title:j&&(j.description||j.key)||"",placement:"right",closable:!1,onClose:()=>A(!1),visible:p,width:800},o.createElement("div",{style:{position:"relative",top:-10}},o.createElement(k,null,o.createElement(v,{title:"导出包含 Response 结果的文件",placement:"top"},o.createElement(u,{size:"small",type:"default",danger:!0,icon:o.createElement(N,null),onClick:()=>{var e;(e=j&&j.key)&&T("/api/export/mock",{params:{id:d,searchPath:e}})}},"导出")),o.createElement(v,{title:"导出 Typescript 类型数据声明的接口文件",placement:"top"},o.createElement(u,{size:"small",type:"default",danger:!0,icon:o.createElement(x,null),onClick:()=>{var e;(e=j&&j.key)&&T("/api/export/typescript",{params:{id:d,searchPath:e}})}},"导出TS")),j&&"post"===j.methods&&o.createElement(w,{color:"green"},"POST"),j&&"get"===j.methods&&o.createElement(w,{color:"blue"},"GET"),j&&"delete"===j.methods&&o.createElement(w,{color:"red"},"DELETE"),j&&"put"===j.methods&&o.createElement(w,{color:"volcano"},"PUT"),j&&j.key)),o.createElement(S,{className:"tabs-oumi",activeKey:P,type:"card",onTabClick:e=>O(e),style:{marginBottom:32}},o.createElement(H,{tab:"默认",key:"1",forceRender:!1},o.createElement("h3",{className:"mbm5"},"请求头（Request）："),o.createElement(V,{code:j&&U(j.request,{resultValueType:"type"})}),o.createElement("h3",{className:"mbm5"},"响应（Response）："),o.createElement(V,{code:j&&U(j.response,{resultValueType:"desc"})})),o.createElement(H,{tab:"详细",key:"2",forceRender:!1},o.createElement("h3",{className:"mbm5"},"请求头（Request）："),o.createElement(V,{code:j&&j.request}),o.createElement("h3",{className:"mbm5"},"响应（Response）："),o.createElement(V,{code:j&&j.response})))))},W=e=>{const{selectNode:t,onSuccess:a}=e,{dirPath:r}=t||{},[n]=m.useForm(),[s,l]=o.useState(!1),{data:i,request:d,loading:E}=z("/api/project/createDir",{lazy:!0}),g=e=>{l(e)};return o.createElement(C,{title:()=>o.createElement("div",null,o.createElement(m,{form:n,className:"my-popconfirm-form"},o.createElement(m.Item,{name:"dirName",label:"目录名称",rules:[{required:!0,message:"请输入目录名称"},{pattern:/^[a-zA-Z0-9_-]+$/,message:"请输入正确的目录名称"}]},o.createElement(p,null)))),visible:s,onConfirm:()=>{n.validateFields().then((e=>{d(c({currentPath:r},e)).then((e=>{l(!1),"function"==typeof a&&a()}))}))},placement:"top",okButtonProps:{loading:E},onCancel:()=>g(!1),icon:!1},o.createElement(u,{size:"middle",disabled:!t,onClick:()=>g(!0)},"新建文件夹"))};const{DirectoryTree:Z}=j;function G(e,t,a){return e.map((e=>e.key===t?i(c({},e),{children:a}):e.children?i(c({},e),{children:G(e.children,t,a)}):e))}var J=e=>{const{selectId:t,setSelectId:a,configId:r}=e,[n,s]=E.exports.useState([]),[l,c]=E.exports.useState(null),{data:i,loading:m,request:p}=z("/api/swagger/build",{lazy:!0}),g=e=>D.post("/api/project/dirs",e),f=()=>{g().then((e=>{s(e)}))};function y({key:e,children:t,dirPath:a}){return new Promise((r=>{t?r():g({currentPath:a}).then((t=>{Array.isArray(t)&&s((a=>G(a,e,t))),r()}))}))}E.exports.useEffect((()=>{f()}),[]);return o.createElement("div",{className:"dirs"},o.createElement("div",{className:"dirs-box"},o.createElement("div",{className:"dirs-head"},"生成接口到目录"," ",o.createElement(v,{title:"生成接口的规则在配置中心修改"},o.createElement(d,null)),"："),o.createElement(Z,{loadData:y,treeData:n,onSelect:(e,t)=>{const{selected:a,node:r}=t,{isLeaf:n}=r;c(a&&!n?r:null)}})),o.createElement("div",{className:"dirs-btn"},o.createElement(k,null,o.createElement(u,{type:"primary",size:"middle",disabled:!l,onClick:()=>{if(t.length<=0&&I.warn("请选择需要导出的api"),l&&t.length>0){const{dirPath:e}=l;p({outputPath:e,searchContent:t,configId:r}).then((e=>{I.success("生成文件成功~"),a([])}))}},loading:m},"生成接口到目录"),o.createElement(W,{selectNode:l,onSuccess:()=>{l&&l.key?y({key:l.key,dirPath:l.key}):f()}}))))};const{TabPane:M}=S,X=()=>o.createElement(L,{title:"Swagger"},o.createElement("div",{className:"swagger-error"},"您当前还没有配置Swagger，去 ",o.createElement(A,{to:"/config"},"配置")," 。"));var Y=E.exports.memo((()=>{const[e,t]=E.exports.useState(""),{data:a,error:r,loading:n}=z("/api/config/swagger/get"),[s]=m.useForm(),{data:l,loading:d,request:p}=z("/api/swagger/info",{lazy:!0}),{request:u}=z("/api/swagger/search",{lazy:!0}),[g,f]=E.exports.useState([]),[y,h]=E.exports.useState({}),[b,k]=E.exports.useState(""),[v,N]=E.exports.useState([]),[x,w]=E.exports.useState([]);E.exports.useEffect((()=>{a&&a.length>0&&t(a[0].id)}),[a]),E.exports.useEffect((()=>{l&&Array.isArray(l.tags)&&f((e=>{const t=[],{paths:a}=e;return Object.keys(a).forEach((e=>{const r=a[e],n=r.get||r.post||r.delete||r.put;if(n){const{tags:e}=n;Array.isArray(e)&&e.forEach((e=>{t.some((t=>t.name===e))||t.push({name:e,description:r.summary,id:F(10)})}))}else console.warn(n)})),t.sort(R("name"))})(l))}),[l]),E.exports.useEffect((()=>{if(e){const t=s.getFieldValue("name");w([]),t?C({name:t}):p({id:e})}}),[e]);const C=t=>{const{name:a}=t;if(void 0===a||""===a)p({id:e});else{const t=F(8);f([{name:a,description:"",id:t}]),N([t]),k(t);const r=/[\u4e00-\u9fa5]+/g,n=a.toLocaleUpperCase().startsWith("V")||r.test(a)?{searchTag:a}:{searchPath:a};u(c({configId:e},n)).then((e=>{if(k(""),"object"==typeof e&&Object.keys(e||{}).length>0){const a={};Object.keys(e).forEach((t=>{const r=e[t];a[t]={description:r.description,methods:r.methods,request:r.request,response:r.response}})),h({[t]:a})}else I.warning("没有数据")}))}};if(n)return o.createElement(L,{title:"Swagger"},o.createElement(P,null));if(r||!Array.isArray(a)||0===a.length)return o.createElement(X,null);const j=e=>{w(e?x.filter((t=>t!==e)):[])},A=o.createElement("div",{className:"popover-selected"},o.createElement("a",{onClick:()=>j()},"清空所有"),x&&x.map((e=>o.createElement("p",{key:e},e," ",o.createElement("span",{onClick:()=>j(e),title:"移除"},o.createElement(O,null))))));return o.createElement(L,{isMain:!0,title:"Swagger",className:"ui-swagger-container"},o.createElement(S,{className:"tabs-oumi",type:"card",defaultActiveKey:e,onTabClick:e=>{t(e)}},a&&a.map((e=>o.createElement(M,{tab:e.name,key:e.id})))),o.createElement("div",{className:"tabs-content"},d&&o.createElement("div",{className:"fetch-loading"},o.createElement(P,null)),o.createElement("div",{className:"selected flex align-items"},o.createElement(B,{form:s,onFinish:C}),o.createElement(T,{content:A,title:"已选中",placement:"bottom"},o.createElement("div",{className:"plp2"},"已选中",o.createElement("span",{className:"span"},x.length),"个"))),o.createElement("div",{className:"body-flex"},o.createElement(K,{tabsId:e,selectId:x,setSelectId:w,swaggerList:g,loadingId:b,expandCacheId:v,expandData:y,onClickSwaggerHead:t=>{v.includes(t.id)?N(v.filter((e=>e!==t.id))):y[t.id]?N([...v,t.id]):(k(t.id),u({configId:e,searchTag:t.name}).then((e=>{if(k(""),"object"==typeof e&&Object.keys(e||{}).length>0){const a={};Object.keys(e).forEach((t=>{const r=e[t];a[t]={description:r.description,methods:r.methods,request:r.request,response:r.response}})),N([...v,t.id]),h(i(c({},y),{[t.id]:a}))}else I.warning("没有数据")})).catch((()=>{k("")})))}}),o.createElement(J,{selectId:x,setSelectId:w,configId:e}))))}));export{Y as default};
