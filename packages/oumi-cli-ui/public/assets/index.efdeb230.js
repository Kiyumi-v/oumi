var e=Object.defineProperty,t=Object.defineProperties,a=Object.getOwnPropertyDescriptors,r=Object.getOwnPropertySymbols,n=Object.prototype.hasOwnProperty,s=Object.prototype.propertyIsEnumerable,l=(t,a,r)=>a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[a]=r,c=(e,t)=>{for(var a in t||(t={}))n.call(t,a)&&l(e,a,t[a]);if(r)for(var a of r(t))s.call(t,a)&&l(e,a,t[a]);return e},o=(e,r)=>t(e,a(r));import{r as i,i as m,R as d,L as p}from"./vendor.37267cca.js";import{f as u,I as f,o as g,a as E,B as h,L as y,u as v,i as b,M as x,S as N,p as w,T as j}from"./index.d84567b9.js";import{T as k,g as O,F as C}from"./conductUtil.72cdf168.js";import{C as P,a as S}from"./CaretDownOutlined.f39c45f4.js";import{g as I,P as D,T as L}from"./Tree.f9210e85.js";import"./FolderOutlined.02fa9457.js";var z=i.exports.forwardRef((function(e,t){var a,r=e.prefixCls,n=e.title,s=e.content,l=function(e,t){var a={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(a[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(r=Object.getOwnPropertySymbols(e);n<r.length;n++)t.indexOf(r[n])<0&&Object.prototype.propertyIsEnumerable.call(e,r[n])&&(a[r[n]]=e[r[n]])}return a}(e,["prefixCls","title","content"]),c=i.exports.useContext(u).getPrefixCls,o=c("popover",r),d=c();return i.exports.createElement(k,m({},l,{prefixCls:o,ref:t,overlay:(a=o,i.exports.createElement(i.exports.Fragment,null,n&&i.exports.createElement("div",{className:"".concat(a,"-title")},I(n)),i.exports.createElement("div",{className:"".concat(a,"-inner-content")},I(s)))),transitionName:O(d,"zoom-big",l.transitionName)}))}));z.displayName="Popover",z.defaultProps={placement:"top",trigger:"hover",mouseEnterDelay:.1,mouseLeaveDelay:.1,overlayStyle:{}};var T={icon:{tag:"svg",attrs:{viewBox:"0 0 1024 1024",focusable:"false"},children:[{tag:"path",attrs:{d:"M715.8 493.5L335 165.1c-14.2-12.2-35-1.2-35 18.5v656.8c0 19.7 20.8 30.7 35 18.5l380.8-328.4c10.9-9.4 10.9-27.6 0-37z"}}]},name:"caret-right",theme:"outlined"},A=function(e,t){return i.exports.createElement(f,Object.assign({},e,{ref:t,icon:T}))};A.displayName="CaretRightOutlined";var F=i.exports.forwardRef(A);const q=(e=8,t)=>{const a=[],r=t||"0123456789abcdef";for(let n=0;n<e;n++)a[n]=r.substr(Math.floor(Math.random()*r.length),1);return a.join("")};var M=e=>{const{onFinish:t}=e;return d.createElement(C,{name:"customized_form_controls",layout:"inline",onFinish:t},d.createElement(C.Item,{name:"name",label:"搜索",tooltip:{title:"首字母是“v”或包含中文表示搜索tag，否则就是搜索path",icon:d.createElement(g,null)}},d.createElement(E,{placeholder:"可搜索关键字、tag、路径",style:{width:230},allowClear:!0})),d.createElement(C.Item,null,d.createElement(h,{type:"primary",htmlType:"submit"},"搜索")))};const R=e=>{const{swaggerList:t,expandData:a={},expandCacheId:r,loadingId:n,onClickSwaggerHead:s,setSelectId:l,selectId:c}=e;return d.createElement("div",{className:"swagger-list"},t&&t.map((e=>d.createElement("div",{className:"swagger-list-item",key:e.id},d.createElement("div",{className:"heading",onClick:()=>s(e)},d.createElement("div",{className:"options"},n===e.id?d.createElement(y,null):r.includes(e.id)?d.createElement(P,null):d.createElement(F,null),r.includes(e.id)&&d.createElement("span",{className:"all",onClick:t=>((e,t)=>{const r=Object.keys(a[t.id]||{});c.includes(r[0])?l(c.filter((e=>!r.includes(e)))):l([...c,...r]),e.stopPropagation(),e.preventDefault()})(t,e)},"全选")),d.createElement("h3",null,e.name)),r.includes(e.id)&&d.createElement("div",{className:"content"},d.createElement("ul",{className:"content-list"},a&&a[e.id]&&Object.keys(a[e.id]).map((t=>{const r=a[e.id][t];return d.createElement("li",{className:`${r.methods||"get"}`,key:t},d.createElement("span",{className:"checkbox"},d.createElement(S,{value:t,onChange:()=>(e=>{c.includes(e)?l(c.filter((t=>t!==e))):l([...c,e])})(t),checked:c.includes(t)})),d.createElement("span",{className:"methods"},(r.methods||"get").toLocaleUpperCase()),d.createElement("span",{className:"path"},t),d.createElement("span",{className:"desc",title:r.description},r.description))}))))))))};var B=e=>{const{selectNode:t,onSuccess:a}=e,{dirPath:r}=t||{},[n]=C.useForm(),[s,l]=d.useState(!1),{data:o,request:i,loading:m}=v("/api/project/createDir",{lazy:!0}),p=e=>{l(e)};return d.createElement(D,{title:()=>d.createElement("div",null,d.createElement(C,{form:n,className:"my-popconfirm-form"},d.createElement(C.Item,{name:"dirName",label:"目录名称",rules:[{required:!0,message:"请输入目录名称"},{pattern:/^[a-zA-Z0-9_-]+$/,message:"请输入正确的目录名称"}]},d.createElement(E,null)))),visible:s,onConfirm:()=>{n.validateFields().then((e=>{i(c({currentPath:r},e)).then((e=>{l(!1),"function"==typeof a&&a()}))}))},placement:"left",okButtonProps:{loading:m},onCancel:()=>p(!1),icon:!1},d.createElement(h,{size:"small",type:"primary",disabled:!t,onClick:()=>p(!0)},"新建文件夹"))};function U(e,t,a){return e.map((e=>e.key===t?o(c({},e),{children:a}):e.children?o(c({},e),{children:U(e.children,t,a)}):e))}var _=e=>{const{selectId:t,configId:a}=e,[r,n]=i.exports.useState([]),[s,l]=i.exports.useState(null),{data:c,loading:o,request:m}=v("/api/swagger/build",{lazy:!0}),p=e=>b.post("/api/project/dirs",e),u=()=>{p().then((e=>{n(e)}))};function f({key:e,children:t,dirPath:a}){return new Promise((r=>{t?r():p({currentPath:a}).then((t=>{Array.isArray(t)&&n((a=>U(a,e,t))),r()}))}))}i.exports.useEffect((()=>{u()}),[]);return d.createElement("div",{className:"dirs"},d.createElement("div",{className:"dirs-box"},d.createElement("div",{className:"dirs-head"},"当前项目目录："),d.createElement(B,{selectNode:s,onSuccess:()=>{s&&s.key?f({key:s.key,dirPath:s.key}):u()}}),d.createElement(L,{showLine:!0,showIcon:!0,loadData:f,treeData:r,onSelect:(e,t)=>{const{selected:a,node:r}=t,{isLeaf:n}=r;l(a&&!n?r:null)}})),d.createElement("div",{className:"dirs-btn"},d.createElement(h,{type:"primary",disabled:!s,onClick:()=>{if(t.length<=0&&x.warn("请选择需要导出的api"),s&&t.length>0){const{dirPath:e}=s;m({outputPath:e,searchContent:t,configId:a}).then((e=>{x.success("生成文件成功~")}))}},loading:o},"生成接口到目录")))};const{TabPane:H}=j,$=e=>d.createElement("div",{className:"ui-swagger-content"},d.createElement("div",{className:"top-header"},d.createElement("h2",null,"Swagger")),d.createElement("div",{className:"ui-content-container ui-swagger-container"},e.children)),K=()=>d.createElement($,null,d.createElement("div",{className:"swagger-error"},"您当前还没有配置Swagger，去 ",d.createElement(p,{to:"/dashboard/config"},"配置")," 。"));export default()=>{const[e,t]=i.exports.useState(""),{data:a,error:r,loading:n}=v("/api/config/swagger/get"),{data:s,loading:l,request:m,source:p}=v("/api/swagger/info",{lazy:!0}),{request:u}=v("/api/swagger/search",{lazy:!0}),[f,g]=i.exports.useState([]),[E,h]=i.exports.useState({}),[y,b]=i.exports.useState(""),[k,O]=i.exports.useState([]),[C,P]=i.exports.useState([]);i.exports.useEffect((()=>()=>{p.cancel()}),[]),i.exports.useEffect((()=>{a&&a.length>0&&t(a[0].id)}),[a]),i.exports.useEffect((()=>{s&&Array.isArray(s.tags)&&g(s.tags.map((e=>o(c({},e),{id:q(8)}))))}),[s]),i.exports.useEffect((()=>{e&&(P([]),m({id:e}))}),[e]);if(n)return d.createElement($,null,d.createElement(N,null));if(r||!Array.isArray(a)||0===a.length)return d.createElement(K,null);const S=e=>{P(e?C.filter((t=>t!==e)):[])},I=d.createElement("div",{className:"popover-selected"},d.createElement("a",{onClick:()=>S()},"清空所有"),C&&C.map((e=>d.createElement("p",{key:e},e," ",d.createElement("span",{onClick:()=>S(e),title:"清除"},d.createElement(w,null))))));return d.createElement($,null,d.createElement(j,{type:"card",defaultActiveKey:e,onTabClick:e=>{t(e)}},a&&a.map((e=>d.createElement(H,{tab:e.name,key:e.id})))),d.createElement("div",{className:"tabs-content"},l&&d.createElement("div",{className:"fetch-loading"},d.createElement(N,null)),d.createElement("div",{className:"selected flex align-items"},d.createElement(M,{onFinish:t=>{const{name:a}=t;if(a){const t=q(8);g([{name:a,description:"",id:t}]),O([t]),b(t);const r=/[\u4e00-\u9fa5]+/g,n=a.toLocaleUpperCase().startsWith("V")||r.test(a)?{searchTag:a}:{searchPath:a};u(c({configId:e},n)).then((e=>{if(b(""),"object"==typeof e&&Object.keys(e||{}).length>0){const a={};Object.keys(e).forEach((t=>{a[t]={description:e[t].description,methods:e[t].methods}})),h({[t]:a})}else x.warning("没有数据")}))}else m({id:e})}}),d.createElement(z,{content:I,title:"已选中",placement:"bottom"},d.createElement("div",{className:"plp2"},"已选中",d.createElement("span",{className:"span"},C.length),"个"))),d.createElement("div",{className:"body-flex"},d.createElement(R,{selectId:C,setSelectId:P,swaggerList:f,loadingId:y,expandCacheId:k,expandData:E,onClickSwaggerHead:t=>{k.includes(t.id)?O(k.filter((e=>e!==t.id))):E[t.id]?O([...k,t.id]):(b(t.id),u({configId:e,searchTag:t.name}).then((e=>{if(b(""),"object"==typeof e&&Object.keys(e||{}).length>0){const a={};Object.keys(e).forEach((t=>{a[t]={description:e[t].description,methods:e[t].methods}})),O([...k,t.id]),h(o(c({},E),{[t.id]:a}))}else x.warning("没有数据")})))}}),d.createElement(_,{selectId:C,configId:e}))))};
